(function(n,t){typeof exports=="object"&&typeof module<"u"?t(require("@vue/runtime-dom"),require("vue"),require("vue-i18n")):typeof define=="function"&&define.amd?define(["@vue/runtime-dom","vue","vue-i18n"],t):(n=typeof globalThis<"u"?globalThis:n||self,t(n.Vue,n.Vue,n.VueI18n))})(this,function(n,t,l){"use strict";const d=t.defineComponent({name:"AsyncTask",props:{uuid:{type:String,required:!0},name:{type:String,required:!0},description:{type:String,required:!0},progression:{type:Number,required:!0},state:{type:String,required:!0},createdAt:{type:String,required:!0},startedAt:{type:String,default:null},completedAt:{type:String,default:null}},computed:{isProcessing:function(){return this.state==="PROCESSING"},isDone:function(){return this.state==="DONE"},isInError:function(){return this.state==="ERROR"},computedProgression:function(){return this.isInError?100:this.progression},asyncDate:function(){return this.completedAt?`${this.$t("async_task.completed_at")} : ${this.completedAt}`:this.startedAt?`${this.$t("async_task.started_at")} : ${this.startedAt}`:`${this.$t("async_task.created_at")} : ${this.createdAt}`}}}),R="",c=(e,s)=>{const o=e.__vccOpts||e;for(const[a,i]of s)o[a]=i;return o},m={class:"async-task-dropdown-item container"},p={class:"row"},u={class:"col-md-12 text-left"},_={class:"async-task-date pull-right"},h={class:"col-md-12 text-left"},y=["innerHTML"],g={class:"col-md-12"},k={class:"progress"},f=["aria-valuenow"];function w(e,s,o,a,i,F){return t.openBlock(),t.createElementBlock("li",m,[t.createElementVNode("div",p,[t.createElementVNode("div",u,[t.createElementVNode("span",{class:t.normalizeClass({"font-bold":!e.isDone})},t.toDisplayString(e.name),3),t.createElementVNode("span",_,[t.createElementVNode("em",null,t.toDisplayString(e.asyncDate),1)])]),t.createElementVNode("div",h,[t.createElementVNode("span",{class:"async-task-text",innerHTML:e.description},null,8,y)]),t.createElementVNode("div",g,[t.createElementVNode("div",k,[t.createElementVNode("div",{class:t.normalizeClass(["progress-bar progress-bar-striped",{active:e.isProcessing,"progress-bar-success":e.isDone,"progress-bar-danger":e.isInError}]),role:"progressbar","aria-valuenow":e.computedProgression,"aria-valuemin":"0","aria-valuemax":"100",style:t.normalizeStyle({width:e.computedProgression+"%"})},[e.isInError?(t.openBlock(),t.createElementBlock(t.Fragment,{key:0},[t.createTextVNode(t.toDisplayString(e.$t("async_task.error_task")),1)],64)):t.createCommentVNode("",!0),e.isInError?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock(t.Fragment,{key:1},[t.createTextVNode(t.toDisplayString(e.computedProgression)+"% ",1)],64))],14,f)])])])])}const $=c(d,[["render",w]]),z=t.defineComponent({name:"AsyncTasksViewer",components:{AsyncTask:$},props:{url:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15}},data(){return{asyncTasks:[],hasNextPage:!1,pageSize:this.limit,error:"",loading:!0,pendingAsyncTasksCount:0,timer:0}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchAsyncTasks(),window.jQuery(document).on("click.bs.dropdown.data-api",".async-tasks-dropdown",e=>e.stopPropagation()),window.jQuery(document).on("AsyncTasksViewer:fetchAsyncTasks",()=>void this.fetchAsyncTasks())},methods:{refreshTimer:function(){let e=this.interval;this.pendingAsyncTasksCount>0&&(e=5),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.fetchAsyncTasks()},e*1e3)},fetchAsyncTasks:async function(){try{const e=await fetch(`${this.url}?limit=${this.pageSize}`);if(e.status>=200&&e.status<300){const s=await e.json();this.asyncTasks=s.results,this.hasNextPage=!!s.next,this.pendingAsyncTasksCount=s.pending_count,this.refreshTimer()}else this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.statusText} )`}catch(e){this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.message} )`}finally{this.loading=!1}},loadMore:async function(e){e.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchAsyncTasks()}}}),H="",E={class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},N=["data-count"],A=[t.createElementVNode("span",{class:"fas fa-tasks"},null,-1)],V={class:"dropdown-menu async-tasks-dropdown"},T={key:0},S={class:"alert alert-warning",role:"alert"},b={key:1},B={key:2,class:"progress"},C={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},D={class:"sr-only"},P={key:3,class:"text-center"};function q(e,s,o,a,i,F){const O=t.resolveComponent("AsyncTask");return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createElementVNode("a",E,[t.createElementVNode("div",{class:t.normalizeClass(["download",{"show-count":e.pendingAsyncTasksCount}]),"data-count":e.pendingAsyncTasksCount},A,10,N)]),t.createElementVNode("ul",V,[e.error?(t.openBlock(),t.createElementBlock("li",T,[t.createElementVNode("div",S,t.toDisplayString(e.error),1)])):t.createCommentVNode("",!0),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.asyncTasks,r=>(t.openBlock(),t.createBlock(O,{key:r.uuid,uuid:r.uuid,name:r.name,description:r.description,progression:r.progression,state:r.state,"created-at":r.created_at,"started-at":r.started_at,"completed-at":r.completed_at},null,8,["uuid","name","description","progression","state","created-at","started-at","completed-at"]))),128)),!e.loading&&!e.asyncTasks.length?(t.openBlock(),t.createElementBlock("li",b,t.toDisplayString(e.$t("async_tasks_viewer.no_results")),1)):t.createCommentVNode("",!0),e.loading?(t.openBlock(),t.createElementBlock("li",B,[t.createElementVNode("div",C,[t.createElementVNode("span",D,t.toDisplayString(e.$t("async_tasks_viewer.load_more")),1)])])):e.hasNextPage?(t.openBlock(),t.createElementBlock("li",P,[t.createElementVNode("button",{type:"button",class:"btn btn-link",onClick:s[0]||(s[0]=(...r)=>e.loadMore&&e.loadMore(...r))},t.toDisplayString(e.$t("async_tasks_viewer.load_more")),1)])):t.createCommentVNode("",!0)])],64)}const I=c(z,[["render",q]]),L={async_tasks_viewer:{error_fetch_async_tasks:e=>{const{normalize:s}=e;return s(["Une erreur s'est produite lors de la récupération des tâches, veuillez réessayer plus tard."])},load_more:e=>{const{normalize:s}=e;return s(["Afficher plus"])},loading:e=>{const{normalize:s}=e;return s(["Chargement"])},no_results:e=>{const{normalize:s}=e;return s(["Aucune tâche en cours."])}},async_task:{created_at:e=>{const{normalize:s}=e;return s(["demandée le"])},started_at:e=>{const{normalize:s}=e;return s(["débutée le"])},completed_at:e=>{const{normalize:s}=e;return s(["terminée le"])},error_task:e=>{const{normalize:s}=e;return s(["Une erreur s'est produite lors de l'exécution de la tâche."])}}},M={async_tasks_viewer:{error_fetch_async_tasks:e=>{const{normalize:s}=e;return s(["An error occurred while fetching tasks, please try again later."])},load_more:e=>{const{normalize:s}=e;return s(["Load more"])},loading:e=>{const{normalize:s}=e;return s(["Loading"])},no_results:e=>{const{normalize:s}=e;return s(["No current tasks."])}},async_task:{created_at:e=>{const{normalize:s}=e;return s(["created at"])},started_at:e=>{const{normalize:s}=e;return s(["started at"])},completed_at:e=>{const{normalize:s}=e;return s(["completed at"])},error_task:e=>{const{normalize:s}=e;return s(["An error occurred while running task"])}}},j=l.createI18n({locale:document.documentElement.lang||"en",messages:{en:M,fr:L}});document.querySelectorAll("#async-tasks-viewer").forEach(e=>{const s={url:"",...e.dataset};typeof e.dataset.interval<"u"&&(s.interval=Number.parseInt(e.dataset.interval)),typeof e.dataset.limit<"u"&&(s.limit=Number.parseInt(e.dataset.limit)),n.createApp(I,s).use(j).mount(e)})});
//# sourceMappingURL=osis-async.umd.min.js.map
