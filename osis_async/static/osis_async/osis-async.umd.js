(function(a,e){typeof exports=="object"&&typeof module<"u"?e(require("@vue/runtime-dom"),require("vue"),require("vue-i18n")):typeof define=="function"&&define.amd?define(["@vue/runtime-dom","vue","vue-i18n"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.Vue,a.Vue,a.VueI18n))})(this,function(a,e,d){"use strict";const l=e.defineComponent({name:"AsyncTask",props:{uuid:{type:String,required:!0},name:{type:String,required:!0},description:{type:String,required:!0},progression:{type:Number,required:!0},state:{type:String,required:!0},createdAt:{type:String,required:!0},startedAt:{type:String,default:null},completedAt:{type:String,default:null}},computed:{isProcessing:function(){return this.state==="PROCESSING"},isDone:function(){return this.state==="DONE"},asyncDate:function(){return this.completedAt?`${this.$t("async_task.completed_at")} : ${this.completedAt}`:this.startedAt?`${this.$t("async_task.started_at")} : ${this.startedAt}`:`${this.$t("async_task.created_at")} : ${this.createdAt}`}}}),Q="",c=(t,s)=>{const r=t.__vccOpts||t;for(const[o,i]of s)r[o]=i;return r},p={class:"async-task-dropdown-item container"},m={class:"row"},u={class:"col-md-12 text-left"},_={class:"async-task-date pull-right"},h={class:"col-md-12 text-left"},y=["innerHTML"],g={class:"col-md-12"},f={class:"progress"},k=["aria-valuenow"];function w(t,s,r,o,i,O){return e.openBlock(),e.createElementBlock("li",p,[e.createElementVNode("div",m,[e.createElementVNode("div",u,[e.createElementVNode("span",{class:e.normalizeClass({"font-bold":!t.isDone})},e.toDisplayString(t.name),3),e.createElementVNode("span",_,[e.createElementVNode("em",null,e.toDisplayString(t.asyncDate),1)])]),e.createElementVNode("div",h,[e.createElementVNode("span",{class:"async-task-text",innerHTML:t.description},null,8,y)]),e.createElementVNode("div",g,[e.createElementVNode("div",f,[e.createElementVNode("div",{class:e.normalizeClass(["progress-bar progress-bar-striped",{active:t.isProcessing,"progress-bar-success":t.isDone}]),role:"progressbar","aria-valuenow":t.progression,"aria-valuemin":"0","aria-valuemax":"100",style:e.normalizeStyle({width:t.progression+"%"})},e.toDisplayString(t.progression)+"% ",15,k)])])])])}const $=c(l,[["render",w]]),A=e.defineComponent({name:"AsyncTasksViewer",components:{AsyncTask:$},props:{url:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15}},data(){return{asyncTasks:[],hasNextPage:!1,pageSize:this.limit,error:"",loading:!0,pendingAsyncTasksCount:0,timer:0}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchAsyncTasks(),window.jQuery(document).on("click.bs.dropdown.data-api",".async-tasks-dropdown",t=>t.stopPropagation()),window.jQuery(document).on("AsyncTasksViewer:fetchAsyncTasks",()=>void this.fetchAsyncTasks())},methods:{refreshTimer:function(){let t=this.interval;this.pendingAsyncTasksCount>0&&(t=5),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.fetchAsyncTasks()},t*1e3)},fetchAsyncTasks:async function(){try{const t=await fetch(`${this.url}?limit=${this.pageSize}`);if(t.status>=200&&t.status<300){const s=await t.json();this.asyncTasks=s.results,this.hasNextPage=!!s.next,this.pendingAsyncTasksCount=s.pending_count,this.refreshTimer()}else this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${t.statusText} )`}catch(t){this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${t.message} )`}finally{this.loading=!1}},loadMore:async function(t){t.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchAsyncTasks()}}}),F="",N={id:"async-tasks-viewer",class:"dropdown"},E={class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},V=["data-count"],T=[e.createElementVNode("span",{class:"fas fa-tasks"},null,-1)],S={class:"dropdown-menu async-tasks-dropdown"},b={key:0},C={class:"alert alert-warning",role:"alert"},B={key:1},D={key:2,class:"progress"},q={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},z={class:"sr-only"},P={key:3,class:"text-center"};function I(t,s,r,o,i,O){const H=e.resolveComponent("AsyncTask");return e.openBlock(),e.createElementBlock("li",N,[e.createElementVNode("a",E,[e.createElementVNode("div",{class:e.normalizeClass(["download",{"show-count":t.pendingAsyncTasksCount}]),"data-count":t.pendingAsyncTasksCount},T,10,V)]),e.createElementVNode("ul",S,[t.error?(e.openBlock(),e.createElementBlock("li",b,[e.createElementVNode("div",C,e.toDisplayString(t.error),1)])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.asyncTasks,n=>(e.openBlock(),e.createBlock(H,{key:n.uuid,uuid:n.uuid,name:n.name,description:n.description,progression:n.progression,state:n.state,"created-at":n.created_at,"started-at":n.started_at,"completed-at":n.completed_at},null,8,["uuid","name","description","progression","state","created-at","started-at","completed-at"]))),128)),!t.loading&&!t.asyncTasks.length?(e.openBlock(),e.createElementBlock("li",B,e.toDisplayString(t.$t("async_tasks_viewer.no_results")),1)):e.createCommentVNode("",!0),t.loading?(e.openBlock(),e.createElementBlock("li",D,[e.createElementVNode("div",q,[e.createElementVNode("span",z,e.toDisplayString(t.$t("async_tasks_viewer.load_more")),1)])])):t.hasNextPage?(e.openBlock(),e.createElementBlock("li",P,[e.createElementVNode("button",{type:"button",class:"btn btn-link",onClick:s[0]||(s[0]=(...n)=>t.loadMore&&t.loadMore(...n))},e.toDisplayString(t.$t("async_tasks_viewer.load_more")),1)])):e.createCommentVNode("",!0)])])}const L=c(A,[["render",I]]),M={en:{async_tasks_viewer:{error_fetch_async_tasks:"An error occurred while fetching tasks, please try again later.",load_more:"Load more",loading:"Loading",no_results:"No current tasks."},async_task:{created_at:"created at",started_at:"started at",completed_at:"completed at"}},"fr-be":{async_tasks_viewer:{error_fetch_async_tasks:"Une erreur s'est produite lors de la récupération des tâches, veuillez réessayer plus tard.",load_more:"Afficher plus",loading:"Chargement",no_results:"Aucune tâche en cours."},async_task:{created_at:"demandée le",started_at:"débutée le",completed_at:"terminée le"}}},j=d.createI18n({locale:document.documentElement.lang||"en",messages:M});document.querySelectorAll("#async-tasks-viewer").forEach(t=>{const s={url:"",...t.dataset};typeof t.dataset.interval<"u"&&(s.interval=Number.parseInt(t.dataset.interval)),typeof t.dataset.limit<"u"&&(s.limit=Number.parseInt(t.dataset.limit)),a.createApp(L,s).use(j).mount(t)})});
//# sourceMappingURL=osis-async.umd.js.map
