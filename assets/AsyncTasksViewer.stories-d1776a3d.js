var Xr=Object.defineProperty;var o=(e,t)=>Xr(e,"name",{value:t,configurable:!0});import{k as un,l as B,m as K,n as x,p as yt,t as te,q as Qr,F as Ke,u as Yt,v as Fe,x as Yr,y as Zr,z as es}from"./vue.esm-bundler-3cfc10b7.js";const ln=un({name:"AsyncTask",props:{uuid:{type:String,required:!0},name:{type:String,required:!0},description:{type:String,required:!0},progression:{type:Number,required:!0},state:{type:String,required:!0},createdAt:{type:String,required:!0},startedAt:{type:String,default:null},completedAt:{type:String,default:null}},computed:{isProcessing:function(){return this.state==="PROCESSING"},isDone:function(){return this.state==="DONE"},isInError:function(){return this.state==="ERROR"},computedProgression:function(){return this.isInError?100:this.progression},asyncDate:function(){return this.completedAt?`${this.$t("async_task.completed_at")} : ${this.completedAt}`:this.startedAt?`${this.$t("async_task.started_at")} : ${this.startedAt}`:`${this.$t("async_task.created_at")} : ${this.createdAt}`}}});const dn=o((e,t)=>{const r=e.__vccOpts||e;for(const[i,a]of t)r[i]=a;return r},"_export_sfc"),ts={class:"async-task-dropdown-item container"},ns={class:"row"},rs={class:"col-md-12 text-left"},ss={class:"async-task-date pull-right"},is={class:"col-md-12 text-left"},os=["innerHTML"],as={class:"col-md-12"},cs={class:"progress"},us=["aria-valuenow"];function ls(e,t,r,i,a,c){return B(),K("li",ts,[x("div",ns,[x("div",rs,[x("span",{class:yt({"font-bold":!e.isDone})},te(e.name),3),x("span",ss,[x("em",null,te(e.asyncDate),1)])]),x("div",is,[x("span",{class:"async-task-text",innerHTML:e.description},null,8,os)]),x("div",as,[x("div",cs,[x("div",{class:yt(["progress-bar progress-bar-striped",{active:e.isProcessing,"progress-bar-success":e.isDone,"progress-bar-danger":e.isInError}]),role:"progressbar","aria-valuenow":e.computedProgression,"aria-valuemin":"0","aria-valuemax":"100",style:Qr({width:e.computedProgression+"%"})},[e.isInError?(B(),K(Ke,{key:0},[Yt(te(e.$t("async_task.error_task")),1)],64)):Fe("",!0),e.isInError?Fe("",!0):(B(),K(Ke,{key:1},[Yt(te(e.computedProgression)+"% ",1)],64))],14,us)])])])])}o(ls,"_sfc_render$1");const ds=dn(ln,[["render",ls]]);ln.__docgenInfo={displayName:"AsyncTask",exportName:"default",description:"",tags:{},props:[{name:"uuid",type:{name:"string"},required:!0},{name:"name",type:{name:"string"},required:!0},{name:"description",type:{name:"string"},required:!0},{name:"progression",type:{name:"number"},required:!0},{name:"state",type:{name:"string"},required:!0},{name:"createdAt",type:{name:"string"},required:!0},{name:"startedAt",type:{name:"string | null"},defaultValue:{func:!1,value:"null"}},{name:"completedAt",type:{name:"string | null"},defaultValue:{func:!1,value:"null"}}],sourceFiles:["/home/runner/work/osis-async/osis-async/frontend/components/AsyncTask.vue"]};const fn=un({name:"AsyncTasksViewer",components:{AsyncTask:ds},props:{url:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15}},data(){return{asyncTasks:[],hasNextPage:!1,pageSize:this.limit,error:"",loading:!0,pendingAsyncTasksCount:0,timer:0}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchAsyncTasks(),window.jQuery(document).on("click.bs.dropdown.data-api",".async-tasks-dropdown",e=>e.stopPropagation()),window.jQuery(document).on("AsyncTasksViewer:fetchAsyncTasks",()=>void this.fetchAsyncTasks())},methods:{refreshTimer:function(){let e=this.interval;this.pendingAsyncTasksCount>0&&(e=5),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.fetchAsyncTasks()},e*1e3)},fetchAsyncTasks:async function(){try{const e=await fetch(`${this.url}?limit=${this.pageSize}`);if(e.status>=200&&e.status<300){const t=await e.json();this.asyncTasks=t.results,this.hasNextPage=!!t.next,this.pendingAsyncTasksCount=t.pending_count,this.refreshTimer()}else this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.statusText} )`}catch(e){this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.message} )`}finally{this.loading=!1}},loadMore:async function(e){e.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchAsyncTasks()}}});const fs={class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},hs=["data-count"],ps=x("span",{class:"fas fa-tasks"},null,-1),gs=[ps],ys={class:"dropdown-menu async-tasks-dropdown"},ms={key:0},bs={class:"alert alert-warning",role:"alert"},vs={key:1},ws={key:2,class:"progress"},_s={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},Cs={class:"sr-only"},As={key:3,class:"text-center"};function Ts(e,t,r,i,a,c){const h=Yr("AsyncTask");return B(),K(Ke,null,[x("a",fs,[x("div",{class:yt(["download",{"show-count":e.pendingAsyncTasksCount}]),"data-count":e.pendingAsyncTasksCount},gs,10,hs)]),x("ul",ys,[e.error?(B(),K("li",ms,[x("div",bs,te(e.error),1)])):Fe("",!0),(B(!0),K(Ke,null,Zr(e.asyncTasks,d=>(B(),es(h,{key:d.uuid,uuid:d.uuid,name:d.name,description:d.description,progression:d.progression,state:d.state,"created-at":d.created_at,"started-at":d.started_at,"completed-at":d.completed_at},null,8,["uuid","name","description","progression","state","created-at","started-at","completed-at"]))),128)),!e.loading&&!e.asyncTasks.length?(B(),K("li",vs,te(e.$t("async_tasks_viewer.no_results")),1)):Fe("",!0),e.loading?(B(),K("li",ws,[x("div",_s,[x("span",Cs,te(e.$t("async_tasks_viewer.load_more")),1)])])):e.hasNextPage?(B(),K("li",As,[x("button",{type:"button",class:"btn btn-link",onClick:t[0]||(t[0]=(...d)=>e.loadMore&&e.loadMore(...d))},te(e.$t("async_tasks_viewer.load_more")),1)])):Fe("",!0)])],64)}o(Ts,"_sfc_render");const Pe=dn(fn,[["render",Ts]]);fn.__docgenInfo={displayName:"AsyncTasksViewer",exportName:"default",description:"",tags:{},props:[{name:"url",type:{name:"string"},required:!0},{name:"interval",type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"limit",type:{name:"number"},defaultValue:{func:!1,value:"15"}}],sourceFiles:["/home/runner/work/osis-async/osis-async/frontend/AsyncTasksViewer.vue"]};var ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}o(Rs,"unwrapExports");function tt(e,t){return t={exports:{}},e(t,t.exports),t.exports}o(tt,"createCommonjsModule");var be=1e3,ve=be*60,we=ve*60,fe=we*24,ks=fe*7,Es=fe*365.25,xs=o(function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Fs(e);if(r==="number"&&isFinite(e))return t.long?Os(e):Ss(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},"ms");function Fs(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*Es;case"weeks":case"week":case"w":return r*ks;case"days":case"day":case"d":return r*fe;case"hours":case"hour":case"hrs":case"hr":case"h":return r*we;case"minutes":case"minute":case"mins":case"min":case"m":return r*ve;case"seconds":case"second":case"secs":case"sec":case"s":return r*be;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}o(Fs,"parse");function Ss(e){var t=Math.abs(e);return t>=fe?Math.round(e/fe)+"d":t>=we?Math.round(e/we)+"h":t>=ve?Math.round(e/ve)+"m":t>=be?Math.round(e/be)+"s":e+"ms"}o(Ss,"fmtShort");function Os(e){var t=Math.abs(e);return t>=fe?Ve(e,t,fe,"day"):t>=we?Ve(e,t,we,"hour"):t>=ve?Ve(e,t,ve,"minute"):t>=be?Ve(e,t,be,"second"):e+" ms"}o(Os,"fmtLong");function Ve(e,t,r,i){var a=t>=r*1.5;return Math.round(e/r)+" "+i+(a?"s":"")}o(Ve,"plural");function $s(e){r.debug=r,r.default=r,r.coerce=l,r.disable=c,r.enable=a,r.enabled=h,r.humanize=xs,r.destroy=g,Object.keys(e).forEach(p=>{r[p]=e[p]}),r.names=[],r.skips=[],r.formatters={};function t(p){let y=0;for(let m=0;m<p.length;m++)y=(y<<5)-y+p.charCodeAt(m),y|=0;return r.colors[Math.abs(y)%r.colors.length]}o(t,"selectColor"),r.selectColor=t;function r(p){let y,m=null;function w(...T){if(!w.enabled)return;const P=w,z=Number(new Date),Ce=z-(y||z);P.diff=Ce,P.prev=y,P.curr=z,y=z,T[0]=r.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let S=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(se,pe)=>{if(se==="%%")return"%";S++;const V=r.formatters[pe];if(typeof V=="function"){const ie=T[S];se=V.call(P,ie),T.splice(S,1),S--}return se}),r.formatArgs.call(P,T),(P.log||r.log).apply(P,T)}return o(w,"debug"),w.namespace=p,w.useColors=r.useColors(),w.color=r.selectColor(p),w.extend=i,w.destroy=r.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?r.enabled(p):m,set:T=>{m=T}}),typeof r.init=="function"&&r.init(w),w}o(r,"createDebug");function i(p,y){const m=r(this.namespace+(typeof y>"u"?":":y)+p);return m.log=this.log,m}o(i,"extend");function a(p){r.save(p),r.names=[],r.skips=[];let y;const m=(typeof p=="string"?p:"").split(/[\s,]+/),w=m.length;for(y=0;y<w;y++)m[y]&&(p=m[y].replace(/\*/g,".*?"),p[0]==="-"?r.skips.push(new RegExp("^"+p.substr(1)+"$")):r.names.push(new RegExp("^"+p+"$")))}o(a,"enable");function c(){const p=[...r.names.map(d),...r.skips.map(d).map(y=>"-"+y)].join(",");return r.enable(""),p}o(c,"disable");function h(p){if(p[p.length-1]==="*")return!0;let y,m;for(y=0,m=r.skips.length;y<m;y++)if(r.skips[y].test(p))return!1;for(y=0,m=r.names.length;y<m;y++)if(r.names[y].test(p))return!0;return!1}o(h,"enabled");function d(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}o(d,"toNamespace");function l(p){return p instanceof Error?p.stack||p.message:p}o(l,"coerce");function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o(g,"destroy"),r.enable(r.load()),r}o($s,"setup");var Ps=$s,j=tt(function(e,t){t.formatArgs=i,t.save=a,t.load=c,t.useColors=r,t.storage=h(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}o(r,"useColors");function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;l.splice(1,0,g,"color: inherit");let p=0,y=0;l[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(p++,m==="%c"&&(y=p))}),l.splice(y,0,g)}o(i,"formatArgs"),t.log=console.debug||console.log||(()=>{});function a(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}o(a,"save");function c(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}o(c,"load");function h(){try{return localStorage}catch{}}o(h,"localstorage"),e.exports=Ps(t);const{formatters:d}=e.exports;d.j=function(l){try{return JSON.stringify(l)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}});j.formatArgs;j.save;j.load;j.useColors;j.storage;j.destroy;j.colors;j.log;let hn,Xe="default",mt="";const bt=o(()=>{hn=j(mt?`fetch-mock:${Xe}:${mt}`:`fetch-mock:${Xe}`)},"newDebug"),Ms=o(e=>j(`fetch-mock:${Xe}:${e}`),"newDebugSandbox");bt();var he={debug:(...e)=>{hn(...e)},setDebugNamespace:e=>{mt=e,bt()},setDebugPhase:e=>{Xe=e||"default",bt()},getDebug:e=>Ms(e)};const{debug:Ns,setDebugPhase:pn}=he,L={};L.mock=function(...e){return pn("setup"),e.length&&this.addRoute(e),this._mock()};L.addRoute=function(e){Ns("Adding route",e);const t=this.compileRoute(e),r=this.routes.filter(({identifier:i,method:a})=>(typeof i=="function"?i===t.identifier:String(i)===String(t.identifier))&&(!a||!t.method||a===t.method));if(this.getOption("overwriteRoutes",t)===!1||!r.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return r.forEach(i=>{const a=this.routes.indexOf(i);this._uncompiledRoutes.splice(a,1,e),this.routes.splice(a,1,t)}),this.routes;if(r.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)};L._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),pn(),this};L.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()};L.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const Qe=o((e,t,r)=>{L[e]=function(i,a,c){return this[t](i,a,Object.assign(c||{},r))}},"defineShorthand"),Ye=o((e,t)=>{L[e]=function(r,i){return this[t]({},r,i)}},"defineGreedyShorthand");Qe("sticky","mock",{sticky:!0});Qe("once","mock",{repeat:1});Ye("any","mock");Ye("anyOnce","once");["get","post","put","delete","head","patch"].forEach(e=>{Qe(e,"mock",{method:e}),Qe(`${e}Once`,"once",{method:e}),Ye(`${e}Any`,e),Ye(`${e}AnyOnce`,`${e}Once`)});const Is=o(e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},"mochaAsyncHookWorkaround"),Ls=o(({sticky:e})=>t=>e?[]:t.filter(({sticky:r})=>r),"getRouteRemover");L.resetBehavior=function(e={}){Is(e);const t=Ls(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this};L.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this};L.restore=L.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var Us=L;const{getDebug:js}=he,Zt=["body","headers","throws","status","redirectUrl"],Rt=class Rt{constructor(t){this.debug=js("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),r=this.buildObservableResponse(t);return[t,r]}sendAsObject(){return Zt.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>Zt.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const r=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(i,a)=>{if(this.responseConfig.redirectUrl){if(a==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(a==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof i[a]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(i[a],{apply:(c,h,d)=>{this.debug(`Calling res.${a}`);const l=c.apply(t,d);return l.then&&(r._holdingPromises.push(l.catch(()=>null)),i._fmResults[a]=l),l}})):i[a]}})}};o(Rt,"ResponseBuilder");let vt=Rt;var Ds=o(e=>new vt(e).exec(),"responseBuilder");let ee;const wt=new RegExp("^[a-z]+://","i"),Gs=new RegExp("^//","i"),en=o(e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),"headersToArray"),tn=o(e=>e.reduce((t,[r,i])=>Object.assign(t,{[r]:i}),{}),"zipObject"),pt=o(e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(wt.test(e))return new ee(e).href;if(Gs.test(e))return new ee(e,"http://dummy").href;{const t=new ee(e,"http://dummy");return t.pathname+t.search}},"normalizeUrl"),Bs=o(async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch{}},"extractBody");var nt={setUrlImplementation:e=>{ee=e},normalizeRequest:(e,t,r)=>{if(r.prototype.isPrototypeOf(e)){const i={method:e.method},a=Bs(e);typeof a<"u"&&(i.body=a);const c={url:pt(e.url),options:Object.assign(i,t),request:e,signal:t&&t.signal||e.signal},h=en(e.headers);return h.length&&(c.options.headers=tn(h)),c}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:pt(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:pt,getPath:e=>(wt.test(e)?new ee(e):new ee(e,"http://dummy")).pathname,getQuery:e=>{const t=wt.test(e)?new ee(e):new ee(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>tn(en(e)),toLowerCase:e=>Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((r,i)=>r===t[i]))}};const{debug:Se,setDebugPhase:gn,getDebug:rt}=he,D={},kt=class kt extends Error{constructor(){super(...arguments),this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}};o(kt,"AbortError");let _t=kt;const qs=o(e=>typeof navigator>"u"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:r}=t;if(!["POST","PUT","PATCH"].includes(r))return e(t);const i=await t.clone().text(),{cache:a,credentials:c,headers:h,integrity:d,mode:l,redirect:g,referrer:p}=t,y={body:i,cache:a,credentials:c,headers:h,integrity:d,mode:l,redirect:g,referrer:p,method:r};return e(t.url,y)},"patchNativeFetchForSafari"),zs=o(async({response:e,responseIsFetch:t=!1},r,i,a)=>{const c=rt("resolve()");for(c("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(c("  Response is a function"),t)return a?(c("  -> Calling fetch with Request instance"),e(a)):(c("  -> Calling fetch with url and options"),e(r,i));c("  -> Calling response function"),e=e(r,i,a)}else if(typeof e.then=="function")c("  Response is a promise"),c("  -> Resolving promise"),e=await e;else return c("  Response is not a function or a promise"),c("  -> Exiting response resolution recursion"),e},"resolve");D.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)};D.fetchHandler=function(e,t){gn("handle");const r=rt("fetchHandler()");r("fetch called with:",e,t);const i=nt.normalizeRequest(e,t,this.config.Request);return r("Request normalised"),r("  url",i.url),r("  options",i.options),r("  request",i.request),r("  signal",i.signal),this.needsAsyncBodyExtraction(i)?(r("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(i)):this._fetchHandler(i)};D._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)};D._fetchHandler=function({url:e,options:t,request:r,signal:i}){const{route:a,callLog:c}=this.executeRouter(e,t,r);this.recordCall(c);let h;return this._holdingPromises.push(new this.config.Promise(d=>h=d)),new this.config.Promise((d,l)=>{if(i){Se("signal exists - enabling fetch abort");const g=o(()=>{Se("aborting fetch"),l(typeof DOMException<"u"?new DOMException("The operation was aborted.","AbortError"):new _t),h()},"abort");i.aborted&&(Se("signal is already aborted - aborting the fetch"),g()),i.addEventListener("abort",g)}this.generateResponse({route:a,url:e,options:t,request:r,callLog:c}).then(d,l).then(h,h).then(()=>{gn()})})};D.fetchHandler.isMock=!0;D.executeRouter=function(e,t,r){const i=rt("executeRouter()"),a={url:e,options:t,request:r,isUnmatched:!0};if(i("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return i("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const c=this.router(e,t,r);if(c)return i("  Matching route found"),{route:c,callLog:{url:e,options:t,request:r,identifier:c.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return i("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:a};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return i("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:a}};D.generateResponse=async function({route:e,url:t,options:r,request:i,callLog:a={}}){const c=rt("generateResponse()"),h=await zs(e,t,r,i);if(h.throws&&typeof h!="function")throw c("response.throws is defined - throwing an error"),h.throws;if(this.config.Response.prototype.isPrototypeOf(h))return c("response is already a Response instance - returning it"),a.response=h,h;const[d,l]=Ds({url:t,responseConfig:h,fetchMock:this,route:e});return a.response=d,l};D.router=function(e,t,r){const i=this.routes.find((a,c)=>(Se(`Trying to match route ${c}`),a.matcher(e,t,r)));if(i)return i};D.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return qs(e)};D.recordCall=function(e){Se("Recording fetch call",e),e&&this._calls.push(e)};var Vs=D,Hs=o(function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var r=String(e),i="",a=t?!!t.extended:!1,c=t?!!t.globstar:!1,h=!1,d=t&&typeof t.flags=="string"?t.flags:"",l,g=0,p=r.length;g<p;g++)switch(l=r[g],l){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+l;break;case"?":if(a){i+=".";break}case"[":case"]":if(a){i+=l;break}case"{":if(a){h=!0,i+="(";break}case"}":if(a){h=!1,i+=")";break}case",":if(h){i+="|";break}i+="\\"+l;break;case"*":for(var y=r[g-1],m=1;r[g+1]==="*";)m++,g++;var w=r[g+1];if(!c)i+=".*";else{var T=m>1&&(y==="/"||y===void 0)&&(w==="/"||w===void 0);T?(i+="((?:[^/]*(?:/|$))*)",g++):i+="([^/]*)"}break;default:i+=l}return(!d||!~d.indexOf("g"))&&(i="^"+i+"$"),new RegExp(i,d)},"globToRegexp"),_e=_n,Ws=At,Js=Ys,Ks=bn,Xs=wn,yn="/",mn="./",Qs=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function At(e,t){for(var r=[],i=0,a=0,c="",h=t&&t.delimiter||yn,d=t&&t.delimiters||mn,l=!1,g;(g=Qs.exec(e))!==null;){var p=g[0],y=g[1],m=g.index;if(c+=e.slice(a,m),a=m+p.length,y){c+=y[1],l=!0;continue}var w="",T=e[a],P=g[2],z=g[3],Ce=g[4],S=g[5];if(!l&&c.length){var re=c.length-1;d.indexOf(c[re])>-1&&(w=c[re],c=c.slice(0,re))}c&&(r.push(c),c="",l=!1);var se=w!==""&&T!==void 0&&T!==w,pe=S==="+"||S==="*",V=S==="?"||S==="*",ie=w||h,Me=z||Ce;r.push({name:P||i++,prefix:w,delimiter:ie,optional:V,repeat:pe,partial:se,pattern:Me?Zs(Me):"[^"+Z(ie)+"]+?"})}return(c||a<e.length)&&r.push(c+e.substr(a)),r}o(At,"parse$1");function Ys(e,t){return bn(At(e,t))}o(Ys,"compile");function bn(e){for(var t=new Array(e.length),r=0;r<e.length;r++)typeof e[r]=="object"&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(i,a){for(var c="",h=a&&a.encode||encodeURIComponent,d=0;d<e.length;d++){var l=e[d];if(typeof l=="string"){c+=l;continue}var g=i?i[l.name]:void 0,p;if(Array.isArray(g)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but got array');if(g.length===0){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var y=0;y<g.length;y++){if(p=h(g[y],l),!t[d].test(p))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'"');c+=(y===0?l.prefix:l.delimiter)+p}continue}if(typeof g=="string"||typeof g=="number"||typeof g=="boolean"){if(p=h(String(g),l),!t[d].test(p))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but got "'+p+'"');c+=l.prefix+p;continue}if(l.optional){l.partial&&(c+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be '+(l.repeat?"an array":"a string"))}return c}}o(bn,"tokensToFunction");function Z(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}o(Z,"escapeString");function Zs(e){return e.replace(/([=!:$/()])/g,"\\$1")}o(Zs,"escapeGroup");function vn(e){return e&&e.sensitive?"":"i"}o(vn,"flags");function ei(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var i=0;i<r.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}o(ei,"regexpToRegexp");function ti(e,t,r){for(var i=[],a=0;a<e.length;a++)i.push(_n(e[a],t,r).source);return new RegExp("(?:"+i.join("|")+")",vn(r))}o(ti,"arrayToRegexp");function ni(e,t,r){return wn(At(e,r),t,r)}o(ni,"stringToRegexp");function wn(e,t,r){r=r||{};for(var i=r.strict,a=r.start!==!1,c=r.end!==!1,h=Z(r.delimiter||yn),d=r.delimiters||mn,l=[].concat(r.endsWith||[]).map(Z).concat("$").join("|"),g=a?"^":"",p=e.length===0,y=0;y<e.length;y++){var m=e[y];if(typeof m=="string")g+=Z(m),p=y===e.length-1&&d.indexOf(m[m.length-1])>-1;else{var w=m.repeat?"(?:"+m.pattern+")(?:"+Z(m.delimiter)+"(?:"+m.pattern+"))*":m.pattern;t&&t.push(m),m.optional?m.partial?g+=Z(m.prefix)+"("+w+")?":g+="(?:"+Z(m.prefix)+"("+w+"))?":g+=Z(m.prefix)+"("+w+")"}}return c?(i||(g+="(?:"+h+")?"),g+=l==="$"?"$":"(?="+l+")"):(i||(g+="(?:"+h+"(?="+l+"))?"),p||(g+="(?="+h+"|"+l+")")),new RegExp(g,vn(r))}o(wn,"tokensToRegExp");function _n(e,t,r){return e instanceof RegExp?ei(e,t):Array.isArray(e)?ti(e,t,r):ni(e,t,r)}o(_n,"pathToRegexp");_e.parse=Ws;_e.compile=Js;_e.tokensToFunction=Ks;_e.tokensToRegExp=Xs;function ri(e,t){return Object.prototype.hasOwnProperty.call(e,t)}o(ri,"hasOwnProperty");var si=o(function(e,t,r,i){t=t||"&",r=r||"=";var a={};if(typeof e!="string"||e.length===0)return a;var c=/\+/g;e=e.split(t);var h=1e3;i&&typeof i.maxKeys=="number"&&(h=i.maxKeys);var d=e.length;h>0&&d>h&&(d=h);for(var l=0;l<d;++l){var g=e[l].replace(c,"%20"),p=g.indexOf(r),y,m,w,T;p>=0?(y=g.substr(0,p),m=g.substr(p+1)):(y=g,m=""),w=decodeURIComponent(y),T=decodeURIComponent(m),ri(a,w)?Array.isArray(a[w])?a[w].push(T):a[w]=[a[w],T]:a[w]=T}return a},"decode"),Ee=o(function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},"stringifyPrimitive"),ii=o(function(e,t,r,i){return t=t||"&",r=r||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(a){var c=encodeURIComponent(Ee(a))+r;return Array.isArray(e[a])?e[a].map(function(h){return c+encodeURIComponent(Ee(h))}).join(t):c+encodeURIComponent(Ee(e[a]))}).join(t):i?encodeURIComponent(Ee(i))+r+encodeURIComponent(Ee(e)):""},"encode"),de=tt(function(e,t){t.decode=t.parse=si,t.encode=t.stringify=ii});de.decode;de.parse;de.encode;de.stringify;var Cn=tt(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(i){function a(c,h){return i.apply(this,arguments)}return o(a,"isSubset"),a.toString=function(){return i.toString()},a}(function(i,a){return typeof i!="object"||i===null||typeof a!="object"||a===null?!1:Object.keys(a).every(function(c){if(!i.propertyIsEnumerable(c))return!1;var h=a[c],d=i[c];return!(typeof h=="object"&&h!==null?!r(d,h):d!==h)})});t.default=r,e.exports=t.default});Rs(Cn);var An=tt(function(e,t){var r=200,i="__lodash_hash_undefined__",a=1,c=2,h=9007199254740991,d="[object Arguments]",l="[object Array]",g="[object AsyncFunction]",p="[object Boolean]",y="[object Date]",m="[object Error]",w="[object Function]",T="[object GeneratorFunction]",P="[object Map]",z="[object Number]",Ce="[object Null]",S="[object Object]",re="[object Promise]",se="[object Proxy]",pe="[object RegExp]",V="[object Set]",ie="[object String]",Me="[object Symbol]",kn="[object Undefined]",it="[object WeakMap]",Et="[object ArrayBuffer]",Ne="[object DataView]",En="[object Float32Array]",xn="[object Float64Array]",Fn="[object Int8Array]",Sn="[object Int16Array]",On="[object Int32Array]",$n="[object Uint8Array]",Pn="[object Uint8ClampedArray]",Mn="[object Uint16Array]",Nn="[object Uint32Array]",In=/[\\^$.*+?()[\]{}|]/g,Ln=/^\[object .+?Constructor\]$/,Un=/^(?:0|[1-9]\d*)$/,C={};C[En]=C[xn]=C[Fn]=C[Sn]=C[On]=C[$n]=C[Pn]=C[Mn]=C[Nn]=!0,C[d]=C[l]=C[Et]=C[p]=C[Ne]=C[y]=C[m]=C[w]=C[P]=C[z]=C[S]=C[pe]=C[V]=C[ie]=C[it]=!1;var xt=typeof ze=="object"&&ze&&ze.Object===Object&&ze,jn=typeof self=="object"&&self&&self.Object===Object&&self,H=xt||jn||Function("return this")(),Ft=t&&!t.nodeType&&t,St=Ft&&!0&&e&&!e.nodeType&&e,Ot=St&&St.exports===Ft,ot=Ot&&xt.process,$t=function(){try{return ot&&ot.binding&&ot.binding("util")}catch{}}(),Pt=$t&&$t.isTypedArray;function Dn(n,s){for(var u=-1,f=n==null?0:n.length,A=0,v=[];++u<f;){var k=n[u];s(k,u,n)&&(v[A++]=k)}return v}o(Dn,"arrayFilter");function Gn(n,s){for(var u=-1,f=s.length,A=n.length;++u<f;)n[A+u]=s[u];return n}o(Gn,"arrayPush");function Bn(n,s){for(var u=-1,f=n==null?0:n.length;++u<f;)if(s(n[u],u,n))return!0;return!1}o(Bn,"arraySome");function qn(n,s){for(var u=-1,f=Array(n);++u<n;)f[u]=s(u);return f}o(qn,"baseTimes");function zn(n){return function(s){return n(s)}}o(zn,"baseUnary");function Vn(n,s){return n.has(s)}o(Vn,"cacheHas");function Hn(n,s){return n==null?void 0:n[s]}o(Hn,"getValue");function Wn(n){var s=-1,u=Array(n.size);return n.forEach(function(f,A){u[++s]=[A,f]}),u}o(Wn,"mapToArray");function Jn(n,s){return function(u){return n(s(u))}}o(Jn,"overArg");function Kn(n){var s=-1,u=Array(n.size);return n.forEach(function(f){u[++s]=f}),u}o(Kn,"setToArray");var Xn=Array.prototype,Qn=Function.prototype,Ie=Object.prototype,at=H["__core-js_shared__"],Mt=Qn.toString,G=Ie.hasOwnProperty,Nt=function(){var n=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),It=Ie.toString,Yn=RegExp("^"+Mt.call(G).replace(In,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lt=Ot?H.Buffer:void 0,Le=H.Symbol,Ut=H.Uint8Array,jt=Ie.propertyIsEnumerable,Zn=Xn.splice,oe=Le?Le.toStringTag:void 0,Dt=Object.getOwnPropertySymbols,er=Lt?Lt.isBuffer:void 0,tr=Jn(Object.keys,Object),ct=ge(H,"DataView"),Ae=ge(H,"Map"),ut=ge(H,"Promise"),lt=ge(H,"Set"),dt=ge(H,"WeakMap"),Te=ge(Object,"create"),nr=ue(ct),rr=ue(Ae),sr=ue(ut),ir=ue(lt),or=ue(dt),Gt=Le?Le.prototype:void 0,ft=Gt?Gt.valueOf:void 0;function ae(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(ae,"Hash");function ar(){this.__data__=Te?Te(null):{},this.size=0}o(ar,"hashClear");function cr(n){var s=this.has(n)&&delete this.__data__[n];return this.size-=s?1:0,s}o(cr,"hashDelete");function ur(n){var s=this.__data__;if(Te){var u=s[n];return u===i?void 0:u}return G.call(s,n)?s[n]:void 0}o(ur,"hashGet");function lr(n){var s=this.__data__;return Te?s[n]!==void 0:G.call(s,n)}o(lr,"hashHas");function dr(n,s){var u=this.__data__;return this.size+=this.has(n)?0:1,u[n]=Te&&s===void 0?i:s,this}o(dr,"hashSet"),ae.prototype.clear=ar,ae.prototype.delete=cr,ae.prototype.get=ur,ae.prototype.has=lr,ae.prototype.set=dr;function W(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(W,"ListCache");function fr(){this.__data__=[],this.size=0}o(fr,"listCacheClear");function hr(n){var s=this.__data__,u=je(s,n);if(u<0)return!1;var f=s.length-1;return u==f?s.pop():Zn.call(s,u,1),--this.size,!0}o(hr,"listCacheDelete");function pr(n){var s=this.__data__,u=je(s,n);return u<0?void 0:s[u][1]}o(pr,"listCacheGet");function gr(n){return je(this.__data__,n)>-1}o(gr,"listCacheHas");function yr(n,s){var u=this.__data__,f=je(u,n);return f<0?(++this.size,u.push([n,s])):u[f][1]=s,this}o(yr,"listCacheSet"),W.prototype.clear=fr,W.prototype.delete=hr,W.prototype.get=pr,W.prototype.has=gr,W.prototype.set=yr;function ce(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(ce,"MapCache");function mr(){this.size=0,this.__data__={hash:new ae,map:new(Ae||W),string:new ae}}o(mr,"mapCacheClear");function br(n){var s=De(this,n).delete(n);return this.size-=s?1:0,s}o(br,"mapCacheDelete");function vr(n){return De(this,n).get(n)}o(vr,"mapCacheGet");function wr(n){return De(this,n).has(n)}o(wr,"mapCacheHas");function _r(n,s){var u=De(this,n),f=u.size;return u.set(n,s),this.size+=u.size==f?0:1,this}o(_r,"mapCacheSet"),ce.prototype.clear=mr,ce.prototype.delete=br,ce.prototype.get=vr,ce.prototype.has=wr,ce.prototype.set=_r;function Ue(n){var s=-1,u=n==null?0:n.length;for(this.__data__=new ce;++s<u;)this.add(n[s])}o(Ue,"SetCache");function Cr(n){return this.__data__.set(n,i),this}o(Cr,"setCacheAdd");function Ar(n){return this.__data__.has(n)}o(Ar,"setCacheHas"),Ue.prototype.add=Ue.prototype.push=Cr,Ue.prototype.has=Ar;function X(n){var s=this.__data__=new W(n);this.size=s.size}o(X,"Stack");function Tr(){this.__data__=new W,this.size=0}o(Tr,"stackClear");function Rr(n){var s=this.__data__,u=s.delete(n);return this.size=s.size,u}o(Rr,"stackDelete");function kr(n){return this.__data__.get(n)}o(kr,"stackGet");function Er(n){return this.__data__.has(n)}o(Er,"stackHas");function xr(n,s){var u=this.__data__;if(u instanceof W){var f=u.__data__;if(!Ae||f.length<r-1)return f.push([n,s]),this.size=++u.size,this;u=this.__data__=new ce(f)}return u.set(n,s),this.size=u.size,this}o(xr,"stackSet"),X.prototype.clear=Tr,X.prototype.delete=Rr,X.prototype.get=kr,X.prototype.has=Er,X.prototype.set=xr;function Fr(n,s){var u=Ge(n),f=!u&&zr(n),A=!u&&!f&&ht(n),v=!u&&!f&&!A&&Xt(n),k=u||f||A||v,E=k?qn(n.length,String):[],F=E.length;for(var R in n)(s||G.call(n,R))&&!(k&&(R=="length"||A&&(R=="offset"||R=="parent")||v&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||jr(R,F)))&&E.push(R);return E}o(Fr,"arrayLikeKeys");function je(n,s){for(var u=n.length;u--;)if(Ht(n[u][0],s))return u;return-1}o(je,"assocIndexOf");function Sr(n,s,u){var f=s(n);return Ge(n)?f:Gn(f,u(n))}o(Sr,"baseGetAllKeys");function Re(n){return n==null?n===void 0?kn:Ce:oe&&oe in Object(n)?Lr(n):qr(n)}o(Re,"baseGetTag");function Bt(n){return ke(n)&&Re(n)==d}o(Bt,"baseIsArguments");function qt(n,s,u,f,A){return n===s?!0:n==null||s==null||!ke(n)&&!ke(s)?n!==n&&s!==s:Or(n,s,u,f,qt,A)}o(qt,"baseIsEqual");function Or(n,s,u,f,A,v){var k=Ge(n),E=Ge(s),F=k?l:Q(n),R=E?l:Q(s);F=F==d?S:F,R=R==d?S:R;var M=F==S,U=R==S,O=F==R;if(O&&ht(n)){if(!ht(s))return!1;k=!0,M=!1}if(O&&!M)return v||(v=new X),k||Xt(n)?zt(n,s,u,f,A,v):Nr(n,s,F,u,f,A,v);if(!(u&a)){var N=M&&G.call(n,"__wrapped__"),I=U&&G.call(s,"__wrapped__");if(N||I){var Y=N?n.value():n,J=I?s.value():s;return v||(v=new X),A(Y,J,u,f,v)}}return O?(v||(v=new X),Ir(n,s,u,f,A,v)):!1}o(Or,"baseIsEqualDeep");function $r(n){if(!Kt(n)||Gr(n))return!1;var s=Wt(n)?Yn:Ln;return s.test(ue(n))}o($r,"baseIsNative");function Pr(n){return ke(n)&&Jt(n.length)&&!!C[Re(n)]}o(Pr,"baseIsTypedArray");function Mr(n){if(!Br(n))return tr(n);var s=[];for(var u in Object(n))G.call(n,u)&&u!="constructor"&&s.push(u);return s}o(Mr,"baseKeys");function zt(n,s,u,f,A,v){var k=u&a,E=n.length,F=s.length;if(E!=F&&!(k&&F>E))return!1;var R=v.get(n);if(R&&v.get(s))return R==s;var M=-1,U=!0,O=u&c?new Ue:void 0;for(v.set(n,s),v.set(s,n);++M<E;){var N=n[M],I=s[M];if(f)var Y=k?f(I,N,M,s,n,v):f(N,I,M,n,s,v);if(Y!==void 0){if(Y)continue;U=!1;break}if(O){if(!Bn(s,function(J,le){if(!Vn(O,le)&&(N===J||A(N,J,u,f,v)))return O.push(le)})){U=!1;break}}else if(!(N===I||A(N,I,u,f,v))){U=!1;break}}return v.delete(n),v.delete(s),U}o(zt,"equalArrays");function Nr(n,s,u,f,A,v,k){switch(u){case Ne:if(n.byteLength!=s.byteLength||n.byteOffset!=s.byteOffset)return!1;n=n.buffer,s=s.buffer;case Et:return!(n.byteLength!=s.byteLength||!v(new Ut(n),new Ut(s)));case p:case y:case z:return Ht(+n,+s);case m:return n.name==s.name&&n.message==s.message;case pe:case ie:return n==s+"";case P:var E=Wn;case V:var F=f&a;if(E||(E=Kn),n.size!=s.size&&!F)return!1;var R=k.get(n);if(R)return R==s;f|=c,k.set(n,s);var M=zt(E(n),E(s),f,A,v,k);return k.delete(n),M;case Me:if(ft)return ft.call(n)==ft.call(s)}return!1}o(Nr,"equalByTag");function Ir(n,s,u,f,A,v){var k=u&a,E=Vt(n),F=E.length,R=Vt(s),M=R.length;if(F!=M&&!k)return!1;for(var U=F;U--;){var O=E[U];if(!(k?O in s:G.call(s,O)))return!1}var N=v.get(n);if(N&&v.get(s))return N==s;var I=!0;v.set(n,s),v.set(s,n);for(var Y=k;++U<F;){O=E[U];var J=n[O],le=s[O];if(f)var Qt=k?f(le,J,O,s,n,v):f(J,le,O,n,s,v);if(!(Qt===void 0?J===le||A(J,le,u,f,v):Qt)){I=!1;break}Y||(Y=O=="constructor")}if(I&&!Y){var Be=n.constructor,qe=s.constructor;Be!=qe&&"constructor"in n&&"constructor"in s&&!(typeof Be=="function"&&Be instanceof Be&&typeof qe=="function"&&qe instanceof qe)&&(I=!1)}return v.delete(n),v.delete(s),I}o(Ir,"equalObjects");function Vt(n){return Sr(n,Wr,Ur)}o(Vt,"getAllKeys");function De(n,s){var u=n.__data__;return Dr(s)?u[typeof s=="string"?"string":"hash"]:u.map}o(De,"getMapData");function ge(n,s){var u=Hn(n,s);return $r(u)?u:void 0}o(ge,"getNative");function Lr(n){var s=G.call(n,oe),u=n[oe];try{n[oe]=void 0;var f=!0}catch{}var A=It.call(n);return f&&(s?n[oe]=u:delete n[oe]),A}o(Lr,"getRawTag");var Ur=Dt?function(n){return n==null?[]:(n=Object(n),Dn(Dt(n),function(s){return jt.call(n,s)}))}:Jr,Q=Re;(ct&&Q(new ct(new ArrayBuffer(1)))!=Ne||Ae&&Q(new Ae)!=P||ut&&Q(ut.resolve())!=re||lt&&Q(new lt)!=V||dt&&Q(new dt)!=it)&&(Q=o(function(n){var s=Re(n),u=s==S?n.constructor:void 0,f=u?ue(u):"";if(f)switch(f){case nr:return Ne;case rr:return P;case sr:return re;case ir:return V;case or:return it}return s},"getTag"));function jr(n,s){return s=s??h,!!s&&(typeof n=="number"||Un.test(n))&&n>-1&&n%1==0&&n<s}o(jr,"isIndex");function Dr(n){var s=typeof n;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?n!=="__proto__":n===null}o(Dr,"isKeyable");function Gr(n){return!!Nt&&Nt in n}o(Gr,"isMasked");function Br(n){var s=n&&n.constructor,u=typeof s=="function"&&s.prototype||Ie;return n===u}o(Br,"isPrototype");function qr(n){return It.call(n)}o(qr,"objectToString");function ue(n){if(n!=null){try{return Mt.call(n)}catch{}try{return n+""}catch{}}return""}o(ue,"toSource");function Ht(n,s){return n===s||n!==n&&s!==s}o(Ht,"eq");var zr=Bt(function(){return arguments}())?Bt:function(n){return ke(n)&&G.call(n,"callee")&&!jt.call(n,"callee")},Ge=Array.isArray;function Vr(n){return n!=null&&Jt(n.length)&&!Wt(n)}o(Vr,"isArrayLike");var ht=er||Kr;function Hr(n,s){return qt(n,s)}o(Hr,"isEqual");function Wt(n){if(!Kt(n))return!1;var s=Re(n);return s==w||s==T||s==g||s==se}o(Wt,"isFunction");function Jt(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=h}o(Jt,"isLength");function Kt(n){var s=typeof n;return n!=null&&(s=="object"||s=="function")}o(Kt,"isObject");function ke(n){return n!=null&&typeof n=="object"}o(ke,"isObjectLike");var Xt=Pt?zn(Pt):Pr;function Wr(n){return Vr(n)?Fr(n):Mr(n)}o(Wr,"keys");function Jr(){return[]}o(Jr,"stubArray");function Kr(){return!1}o(Kr,"stubFalse"),e.exports=Hr});const{debug:b}=he,{headers:He,getPath:Ct,getQuery:oi,normalizeUrl:nn}=nt,xe=o(e=>t=>(b("Actual url:",t),e(t)),"debuggableUrlFunc"),rn={begin:e=>xe(t=>t.indexOf(e)===0),end:e=>xe(t=>t.substr(-e.length)===e),glob:e=>{const t=Hs(e);return xe(r=>t.test(r))},express:e=>{const t=_e(e);return xe(r=>t.test(Ct(r)))},path:e=>xe(t=>Ct(t)===e)},ai=o(({headers:e})=>{if(b("Generating header matcher"),!e){b("  No header expectations defined - skipping");return}const t=He.toLowerCase(e);return b("  Expected headers:",t),(r,{headers:i={}})=>{b("Attempting to match headers");const a=He.toLowerCase(He.normalize(i));return b("  Expected headers:",t),b("  Actual headers:",a),Object.keys(t).every(c=>He.equal(a[c],t[c]))}},"getHeaderMatcher"),ci=o(({method:e})=>{if(b("Generating method matcher"),!e){b("  No method expectations defined - skipping");return}return b("  Expected method:",e),(t,{method:r})=>{b("Attempting to match method");const i=r?r.toLowerCase():"get";return b("  Expected method:",e),b("  Actual method:",i),e===i}},"getMethodMatcher"),ui=o(({query:e})=>{if(b("Generating query parameters matcher"),!e){b("  No query parameters expectations defined - skipping");return}const t=de.parse(de.stringify(e));b("  Expected query parameters:",e);const r=Object.keys(t);return i=>{b("Attempting to match query parameters");const a=de.parse(oi(i));return b("  Expected query parameters:",t),b("  Actual query parameters:",a),r.every(c=>Array.isArray(a[c])?Array.isArray(t[c])?An(a[c].sort(),t[c].sort()):!1:a[c]===t[c])}},"getQueryStringMatcher"),li=o(({params:e,url:t})=>{if(b("Generating path parameters matcher"),!e){b("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");b("  Expected path parameters:",e);const r=Object.keys(e),i=[],a=_e(t.replace(/^express:/,""),i);return c=>{b("Attempting to match path parameters");const h=a.exec(Ct(c))||[];h.shift();const d=i.reduce((l,{name:g},p)=>h[p]?Object.assign(l,{[g]:h[p]}):l,{});return b("  Expected path parameters:",e),b("  Actual path parameters:",d),r.every(l=>d[l]===e[l])}},"getParamsMatcher"),di=o((e,t)=>{const r=t.getOption("matchPartialBody",e),{body:i}=e;return b("Generating body matcher"),(a,{body:c,method:h="get"})=>{if(b("Attempting to match body"),h.toLowerCase()==="get")return b("  GET request - skip matching body"),!0;let d;try{b("  Parsing request body as JSON"),d=JSON.parse(c)}catch(l){b("  Failed to parse request body as JSON",l)}return b("Expected body:",i),b("Actual body:",d),r&&b("matchPartialBody is true - checking for partial match only"),d&&(r?Cn(d,i):An(d,i))}},"getBodyMatcher"),sn=o((e,t,r)=>{b("  Matching using full url",t);const i=nn(t);return b("  Normalised url to:",t),e.identifier===t&&(b("  Updating route identifier to match normalized url:",t),e.identifier=i),a=>(b("Expected url:",i),b("Actual url:",a),r&&i.indexOf("?")?(b("Ignoring query string when matching url"),a.indexOf(i)===0):nn(a)===i)},"getFullUrlMatcher"),fi=o(({functionMatcher:e})=>(b("Detected user defined function matcher",e),(...t)=>(b("Calling function matcher with arguments",t),e(...t))),"getFunctionMatcher"),hi=o(e=>{b("Generating url matcher");const{url:t,query:r}=e;if(t==="*")return b("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return b("  Using regular expression to match url:",t),i=>t.test(i);if(t.href)return b("  Using URL object to match url",t),sn(e,t.href,r);for(const i in rn)if(t.indexOf(i+":")===0){b(`  Using ${i}: pattern to match url`,t);const a=t.replace(new RegExp(`^${i}:`),"");return rn[i](a)}return sn(e,t,r)},"getUrlMatcher");var pi=[{name:"query",matcher:ui},{name:"method",matcher:ci},{name:"headers",matcher:ai},{name:"params",matcher:li},{name:"body",matcher:di,usesBody:!0},{name:"functionMatcher",matcher:fi},{name:"url",matcher:hi}];const{debug:on,setDebugNamespace:an,getDebug:We}=he,cn=o(e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,"isUrlMatcher"),gi=o(e=>typeof e=="function","isFunctionMatcher"),me=class me{constructor(t,r){this.fetchMock=r,We("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!me.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[r,i,a={}]=t,c={};cn(r)||gi(r)?c.matcher=r:Object.assign(c,r),typeof i<"u"&&(c.response=i),Object.assign(c,a),Object.assign(this,c)}sanitize(){const t=We("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),cn(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){an("generateMatcher()"),on("Compiling matcher for route");const t=me.registeredMatchers.map(({name:r,matcher:i,usesBody:a})=>this[r]&&{matcher:i(this,this.fetchMock),usesBody:a}).filter(r=>!!r);this.usesBody=t.some(({usesBody:r})=>r),on("Compiled matcher for route"),an(),this.matcher=(r,i={},a)=>t.every(({matcher:c})=>c(r,i,a))}limit(){const t=We("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const r=this.matcher;let i=this.repeat;this.matcher=(a,c)=>{if(i&&r(a,c))return i--,!0},this.reset=()=>i=this.repeat}delayResponse(){const t=We("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const r=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(i=>setTimeout(()=>i(r),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){me.registeredMatchers.push(t)}};o(me,"Route");let Oe=me;Oe.registeredMatchers=[];pi.forEach(Oe.addMatcher);var Tt=Oe;const{setDebugPhase:Ze,setDebugNamespace:et,debug:_}=he,{normalizeUrl:Tn}=nt,q={},yi=o(e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),"isName"),mi=o(function(e,t={},r){return{matcher:e}=new Tt([Object.assign({matcher:e,response:"ok"},t)],this),r.filter(({url:i,options:a})=>e(Tn(i),a))},"filterCallsWithMatcher"),ne=o(e=>function(...t){Ze("inspect");const r=e.call(this,...t);return Ze(),r},"formatDebug"),bi=o(e=>{if(!e)return;const{url:t,options:r,request:i,identifier:a,isUnmatched:c,response:h}=e,d=[t,r];return d.request=i,d.identifier=a,d.isUnmatched=c,d.response=h,d},"callObjToArray");q.filterCalls=function(e,t){_("Filtering fetch calls");let r=this._calls,i="*";return[!0,"matched"].includes(e)?(_(`Filter provided is ${e}. Returning matched calls only`),r=r.filter(({isUnmatched:a})=>!a)):[!1,"unmatched"].includes(e)?(_(`Filter provided is ${e}. Returning unmatched calls only`),r=r.filter(({isUnmatched:a})=>a)):typeof e>"u"?(_("Filter provided is undefined. Returning all calls"),r=r):yi(e)?(_("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),r=r.filter(({identifier:a})=>a===e)):(i=e==="*"?"*":Tn(e),this.routes.some(({identifier:a})=>a===i)&&(_(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),r=r.filter(a=>a.identifier===i))),(t||i!=="*")&&r.length&&(typeof t=="string"&&(t={method:t}),_("Compiling filter and options to route in order to filter all calls",e),r=mi.call(this,i,t,r)),_(`Retrieved ${r.length} calls`),r.map(bi)};q.calls=ne(function(e,t){return _("retrieving matching calls"),this.filterCalls(e,t)});q.lastCall=ne(function(e,t){return _("retrieving last matching call"),[...this.filterCalls(e,t)].pop()});q.lastUrl=ne(function(e,t){return _("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]});q.lastOptions=ne(function(e,t){return _("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]});q.lastResponse=ne(function(e,t){_("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const r=(this.lastCall(e,t)||[]).response;try{return r.clone()}catch{return Object.entries(r._fmResults).forEach(([a,c])=>{r[a]=()=>c}),r}});q.called=ne(function(e,t){return _("checking if matching call was made"),!!this.filterCalls(e,t).length});q.flush=ne(async function(e){et("flush"),_(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],_(`${t.length} fetch calls to be awaited`),await Promise.all(t),_("All fetch calls have completed"),e&&this._holdingPromises.length&&(_("Awaiting all fetch bodies to download"),await this.flush(e),_("All fetch bodies have completed downloading")),et()});q.done=ne(function(e){Ze("inspect"),et("done"),_("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(_("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(_("Checking to see if expected calls have been made for all routes"),t=this.routes);const r=t.map(({identifier:i})=>{if(!this.called(i))return _("No calls made for route:",i),console.warn(`Warning: ${i} not called`),!1;const a=(this.routes.find(h=>h.identifier===i)||{}).repeat;if(!a)return _("Route has been called at least once, and no expectation of more set:",i),!0;const c=this.filterCalls(i).length;return _(`Route called ${c} times:`,i),a>c?(_(`Route called ${c} times, but expected ${a}:`,i),console.warn(`Warning: ${i} only called ${c} times, but ${a} expected`),!1):!0}).every(i=>i);return et(),Ze(),r});var vi=q;const{debug:Rn}=he,$=Object.assign({},Vs,Us,vi);$.addMatcher=function(e){Tt.addMatcher(e)};$.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0};$.createInstance=function(){Rn("Creating fetch-mock instance");const e=Object.create($);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||$.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e};$.compileRoute=function(e){return new Tt(e,this)};$.bindMethods=function(){this.fetchHandler=$.fetchHandler.bind(this),this.reset=this.restore=$.reset.bind(this),this.resetHistory=$.resetHistory.bind(this),this.resetBehavior=$.resetBehavior.bind(this)};$.sandbox=function(){Rn("Creating sandboxed fetch-mock instance");const t=Object.assign(o((r,i)=>t.fetchHandler(r,i),"fetchMockProxy"),$,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t};$.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var $e=$;const wi={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var _i=wi;const ye=typeof window<"u"?window:self,{setUrlImplementation:Ci}=nt;Ci(ye.URL);$e.global=ye;$e.statusTextMap=_i;$e.config=Object.assign($e.config,{Promise:ye.Promise,Request:ye.Request,Response:ye.Response,Headers:ye.Headers});var st=$e.createInstance();const Je={uuid:"1445bb87-4965-44a5-9889-1b82f49166ec",name:"Génération de document",description:'<a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank">Votre document est disponible ici</a>',state:"DONE",progression:100,created_at:"07/06/2021 12:22",started_at:"07/06/2021 14:22",completed_at:"07/06/2021 14:26"},gt={count:22,pending_count:2,previous:null,next:"mockAsyncTasks2",results:[{uuid:"31d69bd7-07e3-4567-a8f3-1aab41d86061",name:"Génération de document",description:"Votre document est en attente de génération",state:"PENDING",progression:0,created_at:"07/06/2021 12:22",started_at:null,completed_at:null},{uuid:"f66ecf3b-637c-413a-91a7-e318c27ce02f",name:"Génération de document",description:"Votre document est en cours de génération",state:"PROCESSING",progression:45,created_at:"07/06/2021 12:22",started_at:"07/06/2021 14:22",completed_at:null},{...Je,uuid:"1445bb87-4965-44a5-9889-1b82f49166ec"},{...Je,uuid:"1445bb87-4965-44a5-9889-1b82f49166ed"},{...Je,uuid:"1445bb87-4965-44a5-9889-1b82f49166ee"},{...Je,uuid:"1445bb87-4965-44a5-9889-1b82f49a66ef"}]},Ri=o(()=>(st.restore().get("*",{count:0,results:[]}),{components:{AsyncTasksViewer:Pe},template:`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" />
        </li>
      </ul>`}),"NoAsyncTasks"),ki=o(()=>{const e={...gt};return st.restore().get("/?limit=15",function(){return e.results=gt.results.slice(0,15),e}).get("/?limit=30",function(){return e.results=gt.results,e.next=null,e}),{components:{AsyncTasksViewer:Pe},template:`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" :interval="10" />
        </li>
      </ul>
    `}},"WithAsyncTasks"),Ei=o(()=>(st.restore().get("*",{throws:new Error("Failed to fetch")}),{components:{AsyncTasksViewer:Pe},template:`
      <ul class="nav navbar-nav">
      <AsyncTasksViewer url="/" :interval="10" />
      </ul>
    `}),"WithErrors"),xi=o(()=>(st.restore().get("*",{count:0,results:[]}),{components:{AsyncTasksViewer:Pe},template:`
      <div class="clearfix">
        <ul class="nav navbar-nav clearfix">
          <li id="async-tasks-viewer" class="dropdown">
            <AsyncTasksViewer url="/" />
          </li>
        </ul>
      </div>
      <button onclick="let customEvent=new CustomEvent('AsyncTasksViewer:fetchAsyncTasks'); document.dispatchEvent(customEvent); ">
        Refresh via custom event
      </button>
    `}),"EventFetchAsyncTasks"),Fi={parameters:{storySource:{source:`/*
 *
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2023 Université catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
 *
 */

import AsyncTasksViewer from './AsyncTasksViewer.vue';
import fetchMock from 'fetch-mock';
import type {EntriesResponse, Entry} from "./interfaces";
import type {Meta, StoryFn} from "@storybook/vue3";

const completedAsyncTask: Entry = {
  uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
  name: 'Génération de document',
  description: '<a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank">Votre document est disponible ici</a>',
  state: 'DONE',
  progression: 100,
  created_at: '07/06/2021 12:22',
  started_at: '07/06/2021 14:22',
  completed_at: '07/06/2021 14:26',
};

const mockAsyncTasks: EntriesResponse = {
  count: 22,
  pending_count: 2,
  previous: null,
  next: 'mockAsyncTasks2',
  results: [
    {
      uuid: '31d69bd7-07e3-4567-a8f3-1aab41d86061',
      name: 'Génération de document',
      description: 'Votre document est en attente de génération',
      state: 'PENDING',
      progression: 0,
      created_at: '07/06/2021 12:22',
      started_at: null,
      completed_at: null,
    }, {
      uuid: 'f66ecf3b-637c-413a-91a7-e318c27ce02f',
      name: 'Génération de document',
      description: 'Votre document est en cours de génération',
      state: 'PROCESSING',
      progression: 45,
      created_at: '07/06/2021 12:22',
      started_at: '07/06/2021 14:22',
      completed_at: null,
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ed',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ee',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49a66ef',
    },
  ],
};

export const NoAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {count: 0, results: []});
  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" />
        </li>
      </ul>\`,
  };
};

export const WithAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  const currentAsyncTaskPage = {...mockAsyncTasks};
  fetchMock.restore()
      .get('/?limit=15', function () {
        currentAsyncTaskPage.results = mockAsyncTasks.results.slice(0, 15);
        return currentAsyncTaskPage;
      })
      .get('/?limit=30', function () {
        currentAsyncTaskPage.results = mockAsyncTasks.results;
        currentAsyncTaskPage.next = null;
        return currentAsyncTaskPage;
      });

  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" :interval="10" />
        </li>
      </ul>
    \`,
  };
};

export const WithErrors: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {throws: new Error('Failed to fetch')});

  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
      <AsyncTasksViewer url="/" :interval="10" />
      </ul>
    \`,
  };
};


export const EventFetchAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {count: 0, results: []});

  return {
    components: { AsyncTasksViewer },
    template: \`
      <div class="clearfix">
        <ul class="nav navbar-nav clearfix">
          <li id="async-tasks-viewer" class="dropdown">
            <AsyncTasksViewer url="/" />
          </li>
        </ul>
      </div>
      <button onclick="let customEvent=new CustomEvent('AsyncTasksViewer:fetchAsyncTasks'); document.dispatchEvent(customEvent); ">
        Refresh via custom event
      </button>
    \`,
  };
};

export default {
  title: 'Global component',
  component: AsyncTasksViewer,
} as Meta<typeof AsyncTasksViewer>;
`,locationsMap:{"no-async-tasks":{startLoc:{col:62,line:83},endLoc:{col:1,line:94},startBody:{col:62,line:83},endBody:{col:1,line:94}},"with-async-tasks":{startLoc:{col:64,line:96},endLoc:{col:1,line:119},startBody:{col:64,line:96},endBody:{col:1,line:119}},"with-errors":{startLoc:{col:60,line:121},endLoc:{col:1,line:132},startBody:{col:60,line:121},endBody:{col:1,line:132}},"event-fetch-async-tasks":{startLoc:{col:70,line:135},endLoc:{col:1,line:153},startBody:{col:70,line:135},endBody:{col:1,line:153}}}}},title:"Global component",component:Pe},Si=["NoAsyncTasks","WithAsyncTasks","WithErrors","EventFetchAsyncTasks"];export{xi as EventFetchAsyncTasks,Ri as NoAsyncTasks,ki as WithAsyncTasks,Ei as WithErrors,Si as __namedExportsOrder,Fi as default};
//# sourceMappingURL=AsyncTasksViewer.stories-d1776a3d.js.map
