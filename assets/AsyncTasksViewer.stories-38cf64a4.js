var Hr=Object.defineProperty;var o=(e,t)=>Hr(e,"name",{value:t,configurable:!0});import{k as nn,l as Q,m as le,n as x,p as pt,t as de,q as Wr,u as dt,F as Ht,v as Jr,x as Kr,y as Xr}from"./vue.esm-bundler-daddbf1f.js";const rn=nn({name:"AsyncTask",props:{uuid:{type:String,required:!0},name:{type:String,required:!0},description:{type:String,required:!0},progression:{type:Number,required:!0},state:{type:String,required:!0},createdAt:{type:String,required:!0},startedAt:{type:String,default:null},completedAt:{type:String,default:null}},computed:{isProcessing:function(){return this.state==="PROCESSING"},isDone:function(){return this.state==="DONE"},asyncDate:function(){return this.completedAt?`${this.$t("async_task.completed_at")} : ${this.completedAt}`:this.startedAt?`${this.$t("async_task.started_at")} : ${this.startedAt}`:`${this.$t("async_task.created_at")} : ${this.createdAt}`}}});const sn=o((e,t)=>{const r=e.__vccOpts||e;for(const[i,a]of t)r[i]=a;return r},"_export_sfc"),Qr={class:"async-task-dropdown-item container"},Yr={class:"row"},Zr={class:"col-md-12 text-left"},es={class:"async-task-date pull-right"},ts={class:"col-md-12 text-left"},ns=["innerHTML"],rs={class:"col-md-12"},ss={class:"progress"},is=["aria-valuenow"];function os(e,t,r,i,a,c){return Q(),le("li",Qr,[x("div",Yr,[x("div",Zr,[x("span",{class:pt({"font-bold":!e.isDone})},de(e.name),3),x("span",es,[x("em",null,de(e.asyncDate),1)])]),x("div",ts,[x("span",{class:"async-task-text",innerHTML:e.description},null,8,ns)]),x("div",rs,[x("div",ss,[x("div",{class:pt(["progress-bar progress-bar-striped",{active:e.isProcessing,"progress-bar-success":e.isDone}]),role:"progressbar","aria-valuenow":e.progression,"aria-valuemin":"0","aria-valuemax":"100",style:Wr({width:e.progression+"%"})},de(e.progression)+"% ",15,is)])])])])}o(os,"_sfc_render$1");const as=sn(rn,[["render",os]]);rn.__docgenInfo={displayName:"AsyncTask",exportName:"default",description:"",tags:{},props:[{name:"uuid",type:{name:"string"},required:!0},{name:"name",type:{name:"string"},required:!0},{name:"description",type:{name:"string"},required:!0},{name:"progression",type:{name:"number"},required:!0},{name:"state",type:{name:"string"},required:!0},{name:"createdAt",type:{name:"string"},required:!0},{name:"startedAt",type:{name:"string | null"},defaultValue:{func:!1,value:"null"}},{name:"completedAt",type:{name:"string | null"},defaultValue:{func:!1,value:"null"}}]};const on=nn({name:"AsyncTasksViewer",components:{AsyncTask:as},props:{url:{type:String,required:!0},interval:{type:Number,default:300},limit:{type:Number,default:15}},data(){return{asyncTasks:[],hasNextPage:!1,pageSize:this.limit,error:"",loading:!0,pendingAsyncTasksCount:0,timer:0}},unmounted(){window.clearTimeout(this.timer)},mounted(){this.fetchAsyncTasks(),window.jQuery(document).on("click.bs.dropdown.data-api",".async-tasks-dropdown",e=>e.stopPropagation()),window.jQuery(document).on("AsyncTasksViewer:fetchAsyncTasks",()=>void this.fetchAsyncTasks())},methods:{refreshTimer:function(){let e=this.interval;this.pendingAsyncTasksCount>0&&(e=5),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.fetchAsyncTasks()},e*1e3)},fetchAsyncTasks:async function(){try{const e=await fetch(`${this.url}?limit=${this.pageSize}`);if(e.status>=200&&e.status<300){const t=await e.json();this.asyncTasks=t.results,this.hasNextPage=!!t.next,this.pendingAsyncTasksCount=t.pending_count,this.refreshTimer()}else this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.statusText} )`}catch(e){this.error=`${this.$t("async_tasks_viewer.error_fetch_async_tasks")} ( ${e.message} )`}finally{this.loading=!1}},loadMore:async function(e){e.stopPropagation(),this.loading=!0,this.pageSize+=this.limit,await this.fetchAsyncTasks()}}});const cs={class:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},us=["data-count"],ls=x("span",{class:"fas fa-tasks"},null,-1),ds=[ls],fs={class:"dropdown-menu async-tasks-dropdown"},hs={key:0},ps={class:"alert alert-warning",role:"alert"},gs={key:1},ys={key:2,class:"progress"},ms={class:"progress-bar progress-bar-striped active",role:"progressbar","aria-valuenow":"100","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},bs={class:"sr-only"},vs={key:3,class:"text-center"};function ws(e,t,r,i,a,c){const h=Xr("AsyncTask");return Q(),le(Ht,null,[x("a",cs,[x("div",{class:pt(["download",{"show-count":e.pendingAsyncTasksCount}]),"data-count":e.pendingAsyncTasksCount},ds,10,us)]),x("ul",fs,[e.error?(Q(),le("li",hs,[x("div",ps,de(e.error),1)])):dt("",!0),(Q(!0),le(Ht,null,Jr(e.asyncTasks,d=>(Q(),Kr(h,{key:d.uuid,uuid:d.uuid,name:d.name,description:d.description,progression:d.progression,state:d.state,"created-at":d.created_at,"started-at":d.started_at,"completed-at":d.completed_at},null,8,["uuid","name","description","progression","state","created-at","started-at","completed-at"]))),128)),!e.loading&&!e.asyncTasks.length?(Q(),le("li",gs,de(e.$t("async_tasks_viewer.no_results")),1)):dt("",!0),e.loading?(Q(),le("li",ys,[x("div",ms,[x("span",bs,de(e.$t("async_tasks_viewer.load_more")),1)])])):e.hasNextPage?(Q(),le("li",vs,[x("button",{type:"button",class:"btn btn-link",onClick:t[0]||(t[0]=(...d)=>e.loadMore&&e.loadMore(...d))},de(e.$t("async_tasks_viewer.load_more")),1)])):dt("",!0)])],64)}o(ws,"_sfc_render");const Oe=sn(on,[["render",ws]]);on.__docgenInfo={displayName:"AsyncTasksViewer",exportName:"default",description:"",tags:{},props:[{name:"url",type:{name:"string"},required:!0},{name:"interval",type:{name:"number"},defaultValue:{func:!1,value:"300"}},{name:"limit",type:{name:"number"},defaultValue:{func:!1,value:"15"}}]};var Ge=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}o(_s,"unwrapExports");function Ye(e,t){return t={exports:{}},e(t,t.exports),t.exports}o(Ye,"createCommonjsModule");var be=1e3,ve=be*60,we=ve*60,he=we*24,Cs=he*7,As=he*365.25,Ts=o(function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Rs(e);if(r==="number"&&isFinite(e))return t.long?Es(e):ks(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},"ms");function Rs(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*As;case"weeks":case"week":case"w":return r*Cs;case"days":case"day":case"d":return r*he;case"hours":case"hour":case"hrs":case"hr":case"h":return r*we;case"minutes":case"minute":case"mins":case"min":case"m":return r*ve;case"seconds":case"second":case"secs":case"sec":case"s":return r*be;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}o(Rs,"parse");function ks(e){var t=Math.abs(e);return t>=he?Math.round(e/he)+"d":t>=we?Math.round(e/we)+"h":t>=ve?Math.round(e/ve)+"m":t>=be?Math.round(e/be)+"s":e+"ms"}o(ks,"fmtShort");function Es(e){var t=Math.abs(e);return t>=he?qe(e,t,he,"day"):t>=we?qe(e,t,we,"hour"):t>=ve?qe(e,t,ve,"minute"):t>=be?qe(e,t,be,"second"):e+" ms"}o(Es,"fmtLong");function qe(e,t,r,i){var a=t>=r*1.5;return Math.round(e/r)+" "+i+(a?"s":"")}o(qe,"plural");function xs(e){r.debug=r,r.default=r,r.coerce=l,r.disable=c,r.enable=a,r.enabled=h,r.humanize=Ts,r.destroy=g,Object.keys(e).forEach(p=>{r[p]=e[p]}),r.names=[],r.skips=[],r.formatters={};function t(p){let y=0;for(let m=0;m<p.length;m++)y=(y<<5)-y+p.charCodeAt(m),y|=0;return r.colors[Math.abs(y)%r.colors.length]}o(t,"selectColor"),r.selectColor=t;function r(p){let y,m=null;function w(...T){if(!w.enabled)return;const P=w,q=Number(new Date),Ce=q-(y||q);P.diff=Ce,P.prev=y,P.curr=q,y=q,T[0]=r.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let S=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(re,ge)=>{if(re==="%%")return"%";S++;const z=r.formatters[ge];if(typeof z=="function"){const se=T[S];re=z.call(P,se),T.splice(S,1),S--}return re}),r.formatArgs.call(P,T),(P.log||r.log).apply(P,T)}return o(w,"debug"),w.namespace=p,w.useColors=r.useColors(),w.color=r.selectColor(p),w.extend=i,w.destroy=r.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?r.enabled(p):m,set:T=>{m=T}}),typeof r.init=="function"&&r.init(w),w}o(r,"createDebug");function i(p,y){const m=r(this.namespace+(typeof y>"u"?":":y)+p);return m.log=this.log,m}o(i,"extend");function a(p){r.save(p),r.names=[],r.skips=[];let y;const m=(typeof p=="string"?p:"").split(/[\s,]+/),w=m.length;for(y=0;y<w;y++)m[y]&&(p=m[y].replace(/\*/g,".*?"),p[0]==="-"?r.skips.push(new RegExp("^"+p.substr(1)+"$")):r.names.push(new RegExp("^"+p+"$")))}o(a,"enable");function c(){const p=[...r.names.map(d),...r.skips.map(d).map(y=>"-"+y)].join(",");return r.enable(""),p}o(c,"disable");function h(p){if(p[p.length-1]==="*")return!0;let y,m;for(y=0,m=r.skips.length;y<m;y++)if(r.skips[y].test(p))return!1;for(y=0,m=r.names.length;y<m;y++)if(r.names[y].test(p))return!0;return!1}o(h,"enabled");function d(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}o(d,"toNamespace");function l(p){return p instanceof Error?p.stack||p.message:p}o(l,"coerce");function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return o(g,"destroy"),r.enable(r.load()),r}o(xs,"setup");var Fs=xs,j=Ye(function(e,t){t.formatArgs=i,t.save=a,t.load=c,t.useColors=r,t.storage=h(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}o(r,"useColors");function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;l.splice(1,0,g,"color: inherit");let p=0,y=0;l[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(p++,m==="%c"&&(y=p))}),l.splice(y,0,g)}o(i,"formatArgs"),t.log=console.debug||console.log||(()=>{});function a(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}o(a,"save");function c(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}o(c,"load");function h(){try{return localStorage}catch{}}o(h,"localstorage"),e.exports=Fs(t);const{formatters:d}=e.exports;d.j=function(l){try{return JSON.stringify(l)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}});j.formatArgs;j.save;j.load;j.useColors;j.storage;j.destroy;j.colors;j.log;let an,We="default",gt="";const yt=o(()=>{an=j(gt?`fetch-mock:${We}:${gt}`:`fetch-mock:${We}`)},"newDebug"),Ss=o(e=>j(`fetch-mock:${We}:${e}`),"newDebugSandbox");yt();var pe={debug:(...e)=>{an(...e)},setDebugNamespace:e=>{gt=e,yt()},setDebugPhase:e=>{We=e||"default",yt()},getDebug:e=>Ss(e)};const{debug:Os,setDebugPhase:cn}=pe,L={};L.mock=function(...e){return cn("setup"),e.length&&this.addRoute(e),this._mock()};L.addRoute=function(e){Os("Adding route",e);const t=this.compileRoute(e),r=this.routes.filter(({identifier:i,method:a})=>(typeof i=="function"?i===t.identifier:String(i)===String(t.identifier))&&(!a||!t.method||a===t.method));if(this.getOption("overwriteRoutes",t)===!1||!r.length)return this._uncompiledRoutes.push(e),this.routes.push(t);if(this.getOption("overwriteRoutes",t)===!0)return r.forEach(i=>{const a=this.routes.indexOf(i);this._uncompiledRoutes.splice(a,1,e),this.routes.splice(a,1,t)}),this.routes;if(r.length)throw new Error("fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.");this._uncompiledRoutes.push(e),this.routes.push(t)};L._mock=function(){return this.isSandbox||(this.realFetch=this.realFetch||this.global.fetch,this.global.fetch=this.fetchHandler),cn(),this};L.catch=function(e){return this.fallbackResponse&&console.warn("calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response"),this.fallbackResponse=e||"ok",this._mock()};L.spy=function(e){return this._mock(),e?this.mock(e,this.getNativeFetch()):this.catch(this.getNativeFetch())};const Je=o((e,t,r)=>{L[e]=function(i,a,c){return this[t](i,a,Object.assign(c||{},r))}},"defineShorthand"),Ke=o((e,t)=>{L[e]=function(r,i){return this[t]({},r,i)}},"defineGreedyShorthand");Je("sticky","mock",{sticky:!0});Je("once","mock",{repeat:1});Ke("any","mock");Ke("anyOnce","once");["get","post","put","delete","head","patch"].forEach(e=>{Je(e,"mock",{method:e}),Je(`${e}Once`,"once",{method:e}),Ke(`${e}Any`,e),Ke(`${e}AnyOnce`,`${e}Once`)});const $s=o(e=>{typeof e=="function"&&(console.warn("Deprecated: Passing fetch-mock reset methods\ndirectly in as handlers for before/after test runner hooks.\nWrap in an arrow function instead e.g. `() => fetchMock.restore()`"),e())},"mochaAsyncHookWorkaround"),Ps=o(({sticky:e})=>t=>e?[]:t.filter(({sticky:r})=>r),"getRouteRemover");L.resetBehavior=function(e={}){$s(e);const t=Ps(e);return this.routes=t(this.routes),this._uncompiledRoutes=t(this._uncompiledRoutes),this.realFetch&&!this.routes.length&&(this.global.fetch=this.realFetch,this.realFetch=void 0),this.fallbackResponse=void 0,this};L.resetHistory=function(){return this._calls=[],this._holdingPromises=[],this.routes.forEach(e=>e.reset&&e.reset()),this};L.restore=L.reset=function(e){return this.resetBehavior(e),this.resetHistory(),this};var Ms=L;const{getDebug:Ns}=pe,Wt=["body","headers","throws","status","redirectUrl"];class un{constructor(t){this.debug=Ns("ResponseBuilder()"),this.debug("Response builder created with options",t),Object.assign(this,t)}exec(){this.debug("building response"),this.normalizeResponseConfig(),this.constructFetchOpts(),this.constructResponseBody();const t=new this.fetchMock.config.Response(this.body,this.options),r=this.buildObservableResponse(t);return[t,r]}sendAsObject(){return Wt.some(t=>this.responseConfig[t])?!Object.keys(this.responseConfig).every(t=>Wt.includes(t)):!0}normalizeResponseConfig(){typeof this.responseConfig=="number"?(this.debug("building response using status",this.responseConfig),this.responseConfig={status:this.responseConfig}):(typeof this.responseConfig=="string"||this.sendAsObject())&&(this.debug("building text response from",this.responseConfig),this.responseConfig={body:this.responseConfig})}validateStatus(t){if(!t)return this.debug("No status provided. Defaulting to 200"),200;if(typeof t=="number"&&parseInt(t,10)!==t&&t>=200||t<600)return this.debug("Valid status provided",t),t;throw new TypeError(`fetch-mock: Invalid status ${t} passed on response object.
To respond with a JSON object that has status as a property assign the object to body
e.g. {"body": {"status: "registered"}}`)}constructFetchOpts(){this.options=this.responseConfig.options||{},this.options.url=this.responseConfig.redirectUrl||this.url,this.options.status=this.validateStatus(this.responseConfig.status),this.options.statusText=this.fetchMock.statusTextMap[String(this.options.status)],this.options.headers=new this.fetchMock.config.Headers(this.responseConfig.headers||{})}getOption(t){return this.fetchMock.getOption(t,this.route)}convertToJson(){this.getOption("sendAsJson")&&this.responseConfig.body!=null&&typeof this.body=="object"&&(this.debug("Stringifying JSON response body"),this.body=JSON.stringify(this.body),this.options.headers.has("Content-Type")||this.options.headers.set("Content-Type","application/json"))}setContentLength(){this.getOption("includeContentLength")&&typeof this.body=="string"&&!this.options.headers.has("Content-Length")&&(this.debug("Setting content-length header:",this.body.length.toString()),this.options.headers.set("Content-Length",this.body.length.toString()))}constructResponseBody(){if(this.body=this.responseConfig.body,this.convertToJson(),this.setContentLength(),this.Stream){this.debug("Creating response stream");const t=new this.Stream.Readable;this.body!=null&&t.push(this.body,"utf-8"),t.push(null),this.body=t}this.body=this.body}buildObservableResponse(t){const r=this.fetchMock;return t._fmResults={},this.debug("Wrapping Response in ES proxy for observability"),new Proxy(t,{get:(i,a)=>{if(this.responseConfig.redirectUrl){if(a==="url")return this.debug("Retrieving redirect url",this.responseConfig.redirectUrl),this.responseConfig.redirectUrl;if(a==="redirected")return this.debug("Retrieving redirected status",!0),!0}return typeof i[a]=="function"?(this.debug("Wrapping body promises in ES proxies for observability"),new Proxy(i[a],{apply:(c,h,d)=>{this.debug(`Calling res.${a}`);const l=c.apply(t,d);return l.then&&(r._holdingPromises.push(l.catch(()=>null)),i._fmResults[a]=l),l}})):i[a]}})}}o(un,"ResponseBuilder");var Is=o(e=>new un(e).exec(),"responseBuilder");let Z;const mt=new RegExp("^[a-z]+://","i"),Ls=new RegExp("^//","i"),Jt=o(e=>typeof e.raw=="function"?Object.entries(e.raw()):e[Symbol.iterator]?[...e]:Object.entries(e),"headersToArray"),Kt=o(e=>e.reduce((t,[r,i])=>Object.assign(t,{[r]:i}),{}),"zipObject"),ft=o(e=>{if(typeof e=="function"||e instanceof RegExp||/^(begin|end|glob|express|path)\:/.test(e))return e;if(mt.test(e))return new Z(e).href;if(Ls.test(e))return new Z(e,"http://dummy").href;{const t=new Z(e,"http://dummy");return t.pathname+t.search}},"normalizeUrl"),Us=o(async e=>{try{return"body"in e?e.body.toString():e.clone().text()}catch{}},"extractBody");var Ze={setUrlImplementation:e=>{Z=e},normalizeRequest:(e,t,r)=>{if(r.prototype.isPrototypeOf(e)){const i={method:e.method},a=Us(e);typeof a<"u"&&(i.body=a);const c={url:ft(e.url),options:Object.assign(i,t),request:e,signal:t&&t.signal||e.signal},h=Jt(e.headers);return h.length&&(c.options.headers=Kt(h)),c}else{if(typeof e=="string"||typeof e=="object"&&"href"in e)return{url:ft(e),options:t,signal:t&&t.signal};throw typeof e=="object"?new TypeError("fetch-mock: Unrecognised Request object. Read the Config and Installation sections of the docs"):new TypeError("fetch-mock: Invalid arguments passed to fetch")}},normalizeUrl:ft,getPath:e=>(mt.test(e)?new Z(e):new Z(e,"http://dummy")).pathname,getQuery:e=>{const t=mt.test(e)?new Z(e):new Z(e,"http://dummy");return t.search?t.search.substr(1):""},headers:{normalize:e=>Kt(Jt(e)),toLowerCase:e=>Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{}),equal:(e,t)=>(e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.length!==t.length?!1:e.every((r,i)=>r===t[i]))}};const{debug:Fe,setDebugPhase:ln,getDebug:et}=pe,D={};class dn extends Error{constructor(){super(...arguments),this.name="AbortError",this.message="The operation was aborted.",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}o(dn,"AbortError");const js=o(e=>typeof navigator>"u"||!navigator.vendor||navigator.vendor!=="Apple Computer, Inc."?e:async t=>{const{method:r}=t;if(!["POST","PUT","PATCH"].includes(r))return e(t);const i=await t.clone().text(),{cache:a,credentials:c,headers:h,integrity:d,mode:l,redirect:g,referrer:p}=t,y={body:i,cache:a,credentials:c,headers:h,integrity:d,mode:l,redirect:g,referrer:p,method:r};return e(t.url,y)},"patchNativeFetchForSafari"),Ds=o(async({response:e,responseIsFetch:t=!1},r,i,a)=>{const c=et("resolve()");for(c("Recursively resolving function and promise responses");;)if(typeof e=="function"){if(c("  Response is a function"),t)return a?(c("  -> Calling fetch with Request instance"),e(a)):(c("  -> Calling fetch with url and options"),e(r,i));c("  -> Calling response function"),e=e(r,i,a)}else if(typeof e.then=="function")c("  Response is a promise"),c("  -> Resolving promise"),e=await e;else return c("  Response is not a function or a promise"),c("  -> Exiting response resolution recursion"),e},"resolve");D.needsAsyncBodyExtraction=function({request:e}){return e&&this.routes.some(({usesBody:t})=>t)};D.fetchHandler=function(e,t){ln("handle");const r=et("fetchHandler()");r("fetch called with:",e,t);const i=Ze.normalizeRequest(e,t,this.config.Request);return r("Request normalised"),r("  url",i.url),r("  options",i.options),r("  request",i.request),r("  signal",i.signal),this.needsAsyncBodyExtraction(i)?(r("Need to wait for Body to be streamed before calling router: switching to async mode"),this._extractBodyThenHandle(i)):this._fetchHandler(i)};D._extractBodyThenHandle=async function(e){return e.options.body=await e.options.body,this._fetchHandler(e)};D._fetchHandler=function({url:e,options:t,request:r,signal:i}){const{route:a,callLog:c}=this.executeRouter(e,t,r);this.recordCall(c);let h;return this._holdingPromises.push(new this.config.Promise(d=>h=d)),new this.config.Promise((d,l)=>{if(i){Fe("signal exists - enabling fetch abort");const g=o(()=>{Fe("aborting fetch"),l(typeof DOMException<"u"?new DOMException("The operation was aborted.","AbortError"):new dn),h()},"abort");i.aborted&&(Fe("signal is already aborted - aborting the fetch"),g()),i.addEventListener("abort",g)}this.generateResponse({route:a,url:e,options:t,request:r,callLog:c}).then(d,l).then(h,h).then(()=>{ln()})})};D.fetchHandler.isMock=!0;D.executeRouter=function(e,t,r){const i=et("executeRouter()"),a={url:e,options:t,request:r,isUnmatched:!0};if(i("Attempting to match request to a route"),this.getOption("fallbackToNetwork")==="always")return i("  Configured with fallbackToNetwork=always - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0}};const c=this.router(e,t,r);if(c)return i("  Matching route found"),{route:c,callLog:{url:e,options:t,request:r,identifier:c.identifier}};if(this.getOption("warnOnFallback")&&console.warn(`Unmatched ${t&&t.method||"GET"} to ${e}`),this.fallbackResponse)return i("  No matching route found - using fallbackResponse"),{route:{response:this.fallbackResponse},callLog:a};if(!this.getOption("fallbackToNetwork"))throw new Error(`fetch-mock: No fallback response defined for ${t&&t.method||"GET"} to ${e}`);return i("  Configured to fallbackToNetwork - passing through to fetch"),{route:{response:this.getNativeFetch(),responseIsFetch:!0},callLog:a}};D.generateResponse=async function({route:e,url:t,options:r,request:i,callLog:a={}}){const c=et("generateResponse()"),h=await Ds(e,t,r,i);if(h.throws&&typeof h!="function")throw c("response.throws is defined - throwing an error"),h.throws;if(this.config.Response.prototype.isPrototypeOf(h))return c("response is already a Response instance - returning it"),a.response=h,h;const[d,l]=Is({url:t,responseConfig:h,fetchMock:this,route:e});return a.response=d,l};D.router=function(e,t,r){const i=this.routes.find((a,c)=>(Fe(`Trying to match route ${c}`),a.matcher(e,t,r)));if(i)return i};D.getNativeFetch=function(){const e=this.realFetch||this.isSandbox&&this.config.fetch;if(!e)throw new Error("fetch-mock: Falling back to network only available on global fetch-mock, or by setting config.fetch on sandboxed fetch-mock");return js(e)};D.recordCall=function(e){Fe("Recording fetch call",e),e&&this._calls.push(e)};var Bs=D,Gs=o(function(e,t){if(typeof e!="string")throw new TypeError("Expected a string");for(var r=String(e),i="",a=t?!!t.extended:!1,c=t?!!t.globstar:!1,h=!1,d=t&&typeof t.flags=="string"?t.flags:"",l,g=0,p=r.length;g<p;g++)switch(l=r[g],l){case"/":case"$":case"^":case"+":case".":case"(":case")":case"=":case"!":case"|":i+="\\"+l;break;case"?":if(a){i+=".";break}case"[":case"]":if(a){i+=l;break}case"{":if(a){h=!0,i+="(";break}case"}":if(a){h=!1,i+=")";break}case",":if(h){i+="|";break}i+="\\"+l;break;case"*":for(var y=r[g-1],m=1;r[g+1]==="*";)m++,g++;var w=r[g+1];if(!c)i+=".*";else{var T=m>1&&(y==="/"||y===void 0)&&(w==="/"||w===void 0);T?(i+="((?:[^/]*(?:/|$))*)",g++):i+="([^/]*)"}break;default:i+=l}return(!d||!~d.indexOf("g"))&&(i="^"+i+"$"),new RegExp(i,d)},"globToRegexp"),_e=mn,qs=vt,zs=Js,Vs=pn,Hs=yn,fn="/",hn="./",Ws=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function vt(e,t){for(var r=[],i=0,a=0,c="",h=t&&t.delimiter||fn,d=t&&t.delimiters||hn,l=!1,g;(g=Ws.exec(e))!==null;){var p=g[0],y=g[1],m=g.index;if(c+=e.slice(a,m),a=m+p.length,y){c+=y[1],l=!0;continue}var w="",T=e[a],P=g[2],q=g[3],Ce=g[4],S=g[5];if(!l&&c.length){var ne=c.length-1;d.indexOf(c[ne])>-1&&(w=c[ne],c=c.slice(0,ne))}c&&(r.push(c),c="",l=!1);var re=w!==""&&T!==void 0&&T!==w,ge=S==="+"||S==="*",z=S==="?"||S==="*",se=w||h,$e=q||Ce;r.push({name:P||i++,prefix:w,delimiter:se,optional:z,repeat:ge,partial:re,pattern:$e?Ks($e):"[^"+Y(se)+"]+?"})}return(c||a<e.length)&&r.push(c+e.substr(a)),r}o(vt,"parse$1");function Js(e,t){return pn(vt(e,t))}o(Js,"compile");function pn(e){for(var t=new Array(e.length),r=0;r<e.length;r++)typeof e[r]=="object"&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(i,a){for(var c="",h=a&&a.encode||encodeURIComponent,d=0;d<e.length;d++){var l=e[d];if(typeof l=="string"){c+=l;continue}var g=i?i[l.name]:void 0,p;if(Array.isArray(g)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but got array');if(g.length===0){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var y=0;y<g.length;y++){if(p=h(g[y],l),!t[d].test(p))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'"');c+=(y===0?l.prefix:l.delimiter)+p}continue}if(typeof g=="string"||typeof g=="number"||typeof g=="boolean"){if(p=h(String(g),l),!t[d].test(p))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but got "'+p+'"');c+=l.prefix+p;continue}if(l.optional){l.partial&&(c+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be '+(l.repeat?"an array":"a string"))}return c}}o(pn,"tokensToFunction");function Y(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}o(Y,"escapeString");function Ks(e){return e.replace(/([=!:$/()])/g,"\\$1")}o(Ks,"escapeGroup");function gn(e){return e&&e.sensitive?"":"i"}o(gn,"flags");function Xs(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var i=0;i<r.length;i++)t.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}o(Xs,"regexpToRegexp");function Qs(e,t,r){for(var i=[],a=0;a<e.length;a++)i.push(mn(e[a],t,r).source);return new RegExp("(?:"+i.join("|")+")",gn(r))}o(Qs,"arrayToRegexp");function Ys(e,t,r){return yn(vt(e,r),t,r)}o(Ys,"stringToRegexp");function yn(e,t,r){r=r||{};for(var i=r.strict,a=r.start!==!1,c=r.end!==!1,h=Y(r.delimiter||fn),d=r.delimiters||hn,l=[].concat(r.endsWith||[]).map(Y).concat("$").join("|"),g=a?"^":"",p=e.length===0,y=0;y<e.length;y++){var m=e[y];if(typeof m=="string")g+=Y(m),p=y===e.length-1&&d.indexOf(m[m.length-1])>-1;else{var w=m.repeat?"(?:"+m.pattern+")(?:"+Y(m.delimiter)+"(?:"+m.pattern+"))*":m.pattern;t&&t.push(m),m.optional?m.partial?g+=Y(m.prefix)+"("+w+")?":g+="(?:"+Y(m.prefix)+"("+w+"))?":g+=Y(m.prefix)+"("+w+")"}}return c?(i||(g+="(?:"+h+")?"),g+=l==="$"?"$":"(?="+l+")"):(i||(g+="(?:"+h+"(?="+l+"))?"),p||(g+="(?="+h+"|"+l+")")),new RegExp(g,gn(r))}o(yn,"tokensToRegExp");function mn(e,t,r){return e instanceof RegExp?Xs(e,t):Array.isArray(e)?Qs(e,t,r):Ys(e,t,r)}o(mn,"pathToRegexp");_e.parse=qs;_e.compile=zs;_e.tokensToFunction=Vs;_e.tokensToRegExp=Hs;function Zs(e,t){return Object.prototype.hasOwnProperty.call(e,t)}o(Zs,"hasOwnProperty");var ei=o(function(e,t,r,i){t=t||"&",r=r||"=";var a={};if(typeof e!="string"||e.length===0)return a;var c=/\+/g;e=e.split(t);var h=1e3;i&&typeof i.maxKeys=="number"&&(h=i.maxKeys);var d=e.length;h>0&&d>h&&(d=h);for(var l=0;l<d;++l){var g=e[l].replace(c,"%20"),p=g.indexOf(r),y,m,w,T;p>=0?(y=g.substr(0,p),m=g.substr(p+1)):(y=g,m=""),w=decodeURIComponent(y),T=decodeURIComponent(m),Zs(a,w)?Array.isArray(a[w])?a[w].push(T):a[w]=[a[w],T]:a[w]=T}return a},"decode"),Ee=o(function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},"stringifyPrimitive"),ti=o(function(e,t,r,i){return t=t||"&",r=r||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(a){var c=encodeURIComponent(Ee(a))+r;return Array.isArray(e[a])?e[a].map(function(h){return c+encodeURIComponent(Ee(h))}).join(t):c+encodeURIComponent(Ee(e[a]))}).join(t):i?encodeURIComponent(Ee(i))+r+encodeURIComponent(Ee(e)):""},"encode"),fe=Ye(function(e,t){t.decode=t.parse=ei,t.encode=t.stringify=ti});fe.decode;fe.parse;fe.encode;fe.stringify;var bn=Ye(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(i){function a(c,h){return i.apply(this,arguments)}return o(a,"isSubset"),a.toString=function(){return i.toString()},a}(function(i,a){return typeof i!="object"||i===null||typeof a!="object"||a===null?!1:Object.keys(a).every(function(c){if(!i.propertyIsEnumerable(c))return!1;var h=a[c],d=i[c];return!(typeof h=="object"&&h!==null?!r(d,h):d!==h)})});t.default=r,e.exports=t.default});_s(bn);var vn=Ye(function(e,t){var r=200,i="__lodash_hash_undefined__",a=1,c=2,h=9007199254740991,d="[object Arguments]",l="[object Array]",g="[object AsyncFunction]",p="[object Boolean]",y="[object Date]",m="[object Error]",w="[object Function]",T="[object GeneratorFunction]",P="[object Map]",q="[object Number]",Ce="[object Null]",S="[object Object]",ne="[object Promise]",re="[object Proxy]",ge="[object RegExp]",z="[object Set]",se="[object String]",$e="[object Symbol]",Cn="[object Undefined]",nt="[object WeakMap]",_t="[object ArrayBuffer]",Pe="[object DataView]",An="[object Float32Array]",Tn="[object Float64Array]",Rn="[object Int8Array]",kn="[object Int16Array]",En="[object Int32Array]",xn="[object Uint8Array]",Fn="[object Uint8ClampedArray]",Sn="[object Uint16Array]",On="[object Uint32Array]",$n=/[\\^$.*+?()[\]{}|]/g,Pn=/^\[object .+?Constructor\]$/,Mn=/^(?:0|[1-9]\d*)$/,C={};C[An]=C[Tn]=C[Rn]=C[kn]=C[En]=C[xn]=C[Fn]=C[Sn]=C[On]=!0,C[d]=C[l]=C[_t]=C[p]=C[Pe]=C[y]=C[m]=C[w]=C[P]=C[q]=C[S]=C[ge]=C[z]=C[se]=C[nt]=!1;var Ct=typeof Ge=="object"&&Ge&&Ge.Object===Object&&Ge,Nn=typeof self=="object"&&self&&self.Object===Object&&self,V=Ct||Nn||Function("return this")(),At=t&&!t.nodeType&&t,Tt=At&&!0&&e&&!e.nodeType&&e,Rt=Tt&&Tt.exports===At,rt=Rt&&Ct.process,kt=function(){try{return rt&&rt.binding&&rt.binding("util")}catch{}}(),Et=kt&&kt.isTypedArray;function In(n,s){for(var u=-1,f=n==null?0:n.length,A=0,v=[];++u<f;){var k=n[u];s(k,u,n)&&(v[A++]=k)}return v}o(In,"arrayFilter");function Ln(n,s){for(var u=-1,f=s.length,A=n.length;++u<f;)n[A+u]=s[u];return n}o(Ln,"arrayPush");function Un(n,s){for(var u=-1,f=n==null?0:n.length;++u<f;)if(s(n[u],u,n))return!0;return!1}o(Un,"arraySome");function jn(n,s){for(var u=-1,f=Array(n);++u<n;)f[u]=s(u);return f}o(jn,"baseTimes");function Dn(n){return function(s){return n(s)}}o(Dn,"baseUnary");function Bn(n,s){return n.has(s)}o(Bn,"cacheHas");function Gn(n,s){return n==null?void 0:n[s]}o(Gn,"getValue");function qn(n){var s=-1,u=Array(n.size);return n.forEach(function(f,A){u[++s]=[A,f]}),u}o(qn,"mapToArray");function zn(n,s){return function(u){return n(s(u))}}o(zn,"overArg");function Vn(n){var s=-1,u=Array(n.size);return n.forEach(function(f){u[++s]=f}),u}o(Vn,"setToArray");var Hn=Array.prototype,Wn=Function.prototype,Me=Object.prototype,st=V["__core-js_shared__"],xt=Wn.toString,B=Me.hasOwnProperty,Ft=function(){var n=/[^.]+$/.exec(st&&st.keys&&st.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),St=Me.toString,Jn=RegExp("^"+xt.call(B).replace($n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ot=Rt?V.Buffer:void 0,Ne=V.Symbol,$t=V.Uint8Array,Pt=Me.propertyIsEnumerable,Kn=Hn.splice,ie=Ne?Ne.toStringTag:void 0,Mt=Object.getOwnPropertySymbols,Xn=Ot?Ot.isBuffer:void 0,Qn=zn(Object.keys,Object),it=ye(V,"DataView"),Ae=ye(V,"Map"),ot=ye(V,"Promise"),at=ye(V,"Set"),ct=ye(V,"WeakMap"),Te=ye(Object,"create"),Yn=ce(it),Zn=ce(Ae),er=ce(ot),tr=ce(at),nr=ce(ct),Nt=Ne?Ne.prototype:void 0,ut=Nt?Nt.valueOf:void 0;function oe(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(oe,"Hash");function rr(){this.__data__=Te?Te(null):{},this.size=0}o(rr,"hashClear");function sr(n){var s=this.has(n)&&delete this.__data__[n];return this.size-=s?1:0,s}o(sr,"hashDelete");function ir(n){var s=this.__data__;if(Te){var u=s[n];return u===i?void 0:u}return B.call(s,n)?s[n]:void 0}o(ir,"hashGet");function or(n){var s=this.__data__;return Te?s[n]!==void 0:B.call(s,n)}o(or,"hashHas");function ar(n,s){var u=this.__data__;return this.size+=this.has(n)?0:1,u[n]=Te&&s===void 0?i:s,this}o(ar,"hashSet"),oe.prototype.clear=rr,oe.prototype.delete=sr,oe.prototype.get=ir,oe.prototype.has=or,oe.prototype.set=ar;function H(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(H,"ListCache");function cr(){this.__data__=[],this.size=0}o(cr,"listCacheClear");function ur(n){var s=this.__data__,u=Le(s,n);if(u<0)return!1;var f=s.length-1;return u==f?s.pop():Kn.call(s,u,1),--this.size,!0}o(ur,"listCacheDelete");function lr(n){var s=this.__data__,u=Le(s,n);return u<0?void 0:s[u][1]}o(lr,"listCacheGet");function dr(n){return Le(this.__data__,n)>-1}o(dr,"listCacheHas");function fr(n,s){var u=this.__data__,f=Le(u,n);return f<0?(++this.size,u.push([n,s])):u[f][1]=s,this}o(fr,"listCacheSet"),H.prototype.clear=cr,H.prototype.delete=ur,H.prototype.get=lr,H.prototype.has=dr,H.prototype.set=fr;function ae(n){var s=-1,u=n==null?0:n.length;for(this.clear();++s<u;){var f=n[s];this.set(f[0],f[1])}}o(ae,"MapCache");function hr(){this.size=0,this.__data__={hash:new oe,map:new(Ae||H),string:new oe}}o(hr,"mapCacheClear");function pr(n){var s=Ue(this,n).delete(n);return this.size-=s?1:0,s}o(pr,"mapCacheDelete");function gr(n){return Ue(this,n).get(n)}o(gr,"mapCacheGet");function yr(n){return Ue(this,n).has(n)}o(yr,"mapCacheHas");function mr(n,s){var u=Ue(this,n),f=u.size;return u.set(n,s),this.size+=u.size==f?0:1,this}o(mr,"mapCacheSet"),ae.prototype.clear=hr,ae.prototype.delete=pr,ae.prototype.get=gr,ae.prototype.has=yr,ae.prototype.set=mr;function Ie(n){var s=-1,u=n==null?0:n.length;for(this.__data__=new ae;++s<u;)this.add(n[s])}o(Ie,"SetCache");function br(n){return this.__data__.set(n,i),this}o(br,"setCacheAdd");function vr(n){return this.__data__.has(n)}o(vr,"setCacheHas"),Ie.prototype.add=Ie.prototype.push=br,Ie.prototype.has=vr;function J(n){var s=this.__data__=new H(n);this.size=s.size}o(J,"Stack");function wr(){this.__data__=new H,this.size=0}o(wr,"stackClear");function _r(n){var s=this.__data__,u=s.delete(n);return this.size=s.size,u}o(_r,"stackDelete");function Cr(n){return this.__data__.get(n)}o(Cr,"stackGet");function Ar(n){return this.__data__.has(n)}o(Ar,"stackHas");function Tr(n,s){var u=this.__data__;if(u instanceof H){var f=u.__data__;if(!Ae||f.length<r-1)return f.push([n,s]),this.size=++u.size,this;u=this.__data__=new ae(f)}return u.set(n,s),this.size=u.size,this}o(Tr,"stackSet"),J.prototype.clear=wr,J.prototype.delete=_r,J.prototype.get=Cr,J.prototype.has=Ar,J.prototype.set=Tr;function Rr(n,s){var u=je(n),f=!u&&Dr(n),A=!u&&!f&&lt(n),v=!u&&!f&&!A&&zt(n),k=u||f||A||v,E=k?jn(n.length,String):[],F=E.length;for(var R in n)(s||B.call(n,R))&&!(k&&(R=="length"||A&&(R=="offset"||R=="parent")||v&&(R=="buffer"||R=="byteLength"||R=="byteOffset")||Nr(R,F)))&&E.push(R);return E}o(Rr,"arrayLikeKeys");function Le(n,s){for(var u=n.length;u--;)if(Dt(n[u][0],s))return u;return-1}o(Le,"assocIndexOf");function kr(n,s,u){var f=s(n);return je(n)?f:Ln(f,u(n))}o(kr,"baseGetAllKeys");function Re(n){return n==null?n===void 0?Cn:Ce:ie&&ie in Object(n)?Pr(n):jr(n)}o(Re,"baseGetTag");function It(n){return ke(n)&&Re(n)==d}o(It,"baseIsArguments");function Lt(n,s,u,f,A){return n===s?!0:n==null||s==null||!ke(n)&&!ke(s)?n!==n&&s!==s:Er(n,s,u,f,Lt,A)}o(Lt,"baseIsEqual");function Er(n,s,u,f,A,v){var k=je(n),E=je(s),F=k?l:K(n),R=E?l:K(s);F=F==d?S:F,R=R==d?S:R;var M=F==S,U=R==S,O=F==R;if(O&&lt(n)){if(!lt(s))return!1;k=!0,M=!1}if(O&&!M)return v||(v=new J),k||zt(n)?Ut(n,s,u,f,A,v):Or(n,s,F,u,f,A,v);if(!(u&a)){var N=M&&B.call(n,"__wrapped__"),I=U&&B.call(s,"__wrapped__");if(N||I){var X=N?n.value():n,W=I?s.value():s;return v||(v=new J),A(X,W,u,f,v)}}return O?(v||(v=new J),$r(n,s,u,f,A,v)):!1}o(Er,"baseIsEqualDeep");function xr(n){if(!qt(n)||Lr(n))return!1;var s=Bt(n)?Jn:Pn;return s.test(ce(n))}o(xr,"baseIsNative");function Fr(n){return ke(n)&&Gt(n.length)&&!!C[Re(n)]}o(Fr,"baseIsTypedArray");function Sr(n){if(!Ur(n))return Qn(n);var s=[];for(var u in Object(n))B.call(n,u)&&u!="constructor"&&s.push(u);return s}o(Sr,"baseKeys");function Ut(n,s,u,f,A,v){var k=u&a,E=n.length,F=s.length;if(E!=F&&!(k&&F>E))return!1;var R=v.get(n);if(R&&v.get(s))return R==s;var M=-1,U=!0,O=u&c?new Ie:void 0;for(v.set(n,s),v.set(s,n);++M<E;){var N=n[M],I=s[M];if(f)var X=k?f(I,N,M,s,n,v):f(N,I,M,n,s,v);if(X!==void 0){if(X)continue;U=!1;break}if(O){if(!Un(s,function(W,ue){if(!Bn(O,ue)&&(N===W||A(N,W,u,f,v)))return O.push(ue)})){U=!1;break}}else if(!(N===I||A(N,I,u,f,v))){U=!1;break}}return v.delete(n),v.delete(s),U}o(Ut,"equalArrays");function Or(n,s,u,f,A,v,k){switch(u){case Pe:if(n.byteLength!=s.byteLength||n.byteOffset!=s.byteOffset)return!1;n=n.buffer,s=s.buffer;case _t:return!(n.byteLength!=s.byteLength||!v(new $t(n),new $t(s)));case p:case y:case q:return Dt(+n,+s);case m:return n.name==s.name&&n.message==s.message;case ge:case se:return n==s+"";case P:var E=qn;case z:var F=f&a;if(E||(E=Vn),n.size!=s.size&&!F)return!1;var R=k.get(n);if(R)return R==s;f|=c,k.set(n,s);var M=Ut(E(n),E(s),f,A,v,k);return k.delete(n),M;case $e:if(ut)return ut.call(n)==ut.call(s)}return!1}o(Or,"equalByTag");function $r(n,s,u,f,A,v){var k=u&a,E=jt(n),F=E.length,R=jt(s),M=R.length;if(F!=M&&!k)return!1;for(var U=F;U--;){var O=E[U];if(!(k?O in s:B.call(s,O)))return!1}var N=v.get(n);if(N&&v.get(s))return N==s;var I=!0;v.set(n,s),v.set(s,n);for(var X=k;++U<F;){O=E[U];var W=n[O],ue=s[O];if(f)var Vt=k?f(ue,W,O,s,n,v):f(W,ue,O,n,s,v);if(!(Vt===void 0?W===ue||A(W,ue,u,f,v):Vt)){I=!1;break}X||(X=O=="constructor")}if(I&&!X){var De=n.constructor,Be=s.constructor;De!=Be&&"constructor"in n&&"constructor"in s&&!(typeof De=="function"&&De instanceof De&&typeof Be=="function"&&Be instanceof Be)&&(I=!1)}return v.delete(n),v.delete(s),I}o($r,"equalObjects");function jt(n){return kr(n,qr,Mr)}o(jt,"getAllKeys");function Ue(n,s){var u=n.__data__;return Ir(s)?u[typeof s=="string"?"string":"hash"]:u.map}o(Ue,"getMapData");function ye(n,s){var u=Gn(n,s);return xr(u)?u:void 0}o(ye,"getNative");function Pr(n){var s=B.call(n,ie),u=n[ie];try{n[ie]=void 0;var f=!0}catch{}var A=St.call(n);return f&&(s?n[ie]=u:delete n[ie]),A}o(Pr,"getRawTag");var Mr=Mt?function(n){return n==null?[]:(n=Object(n),In(Mt(n),function(s){return Pt.call(n,s)}))}:zr,K=Re;(it&&K(new it(new ArrayBuffer(1)))!=Pe||Ae&&K(new Ae)!=P||ot&&K(ot.resolve())!=ne||at&&K(new at)!=z||ct&&K(new ct)!=nt)&&(K=o(function(n){var s=Re(n),u=s==S?n.constructor:void 0,f=u?ce(u):"";if(f)switch(f){case Yn:return Pe;case Zn:return P;case er:return ne;case tr:return z;case nr:return nt}return s},"getTag"));function Nr(n,s){return s=s??h,!!s&&(typeof n=="number"||Mn.test(n))&&n>-1&&n%1==0&&n<s}o(Nr,"isIndex");function Ir(n){var s=typeof n;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?n!=="__proto__":n===null}o(Ir,"isKeyable");function Lr(n){return!!Ft&&Ft in n}o(Lr,"isMasked");function Ur(n){var s=n&&n.constructor,u=typeof s=="function"&&s.prototype||Me;return n===u}o(Ur,"isPrototype");function jr(n){return St.call(n)}o(jr,"objectToString");function ce(n){if(n!=null){try{return xt.call(n)}catch{}try{return n+""}catch{}}return""}o(ce,"toSource");function Dt(n,s){return n===s||n!==n&&s!==s}o(Dt,"eq");var Dr=It(function(){return arguments}())?It:function(n){return ke(n)&&B.call(n,"callee")&&!Pt.call(n,"callee")},je=Array.isArray;function Br(n){return n!=null&&Gt(n.length)&&!Bt(n)}o(Br,"isArrayLike");var lt=Xn||Vr;function Gr(n,s){return Lt(n,s)}o(Gr,"isEqual");function Bt(n){if(!qt(n))return!1;var s=Re(n);return s==w||s==T||s==g||s==re}o(Bt,"isFunction");function Gt(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=h}o(Gt,"isLength");function qt(n){var s=typeof n;return n!=null&&(s=="object"||s=="function")}o(qt,"isObject");function ke(n){return n!=null&&typeof n=="object"}o(ke,"isObjectLike");var zt=Et?Dn(Et):Fr;function qr(n){return Br(n)?Rr(n):Sr(n)}o(qr,"keys");function zr(){return[]}o(zr,"stubArray");function Vr(){return!1}o(Vr,"stubFalse"),e.exports=Gr});const{debug:b}=pe,{headers:ze,getPath:bt,getQuery:ni,normalizeUrl:Xt}=Ze,xe=o(e=>t=>(b("Actual url:",t),e(t)),"debuggableUrlFunc"),Qt={begin:e=>xe(t=>t.indexOf(e)===0),end:e=>xe(t=>t.substr(-e.length)===e),glob:e=>{const t=Gs(e);return xe(r=>t.test(r))},express:e=>{const t=_e(e);return xe(r=>t.test(bt(r)))},path:e=>xe(t=>bt(t)===e)},ri=o(({headers:e})=>{if(b("Generating header matcher"),!e){b("  No header expectations defined - skipping");return}const t=ze.toLowerCase(e);return b("  Expected headers:",t),(r,{headers:i={}})=>{b("Attempting to match headers");const a=ze.toLowerCase(ze.normalize(i));return b("  Expected headers:",t),b("  Actual headers:",a),Object.keys(t).every(c=>ze.equal(a[c],t[c]))}},"getHeaderMatcher"),si=o(({method:e})=>{if(b("Generating method matcher"),!e){b("  No method expectations defined - skipping");return}return b("  Expected method:",e),(t,{method:r})=>{b("Attempting to match method");const i=r?r.toLowerCase():"get";return b("  Expected method:",e),b("  Actual method:",i),e===i}},"getMethodMatcher"),ii=o(({query:e})=>{if(b("Generating query parameters matcher"),!e){b("  No query parameters expectations defined - skipping");return}const t=fe.parse(fe.stringify(e));b("  Expected query parameters:",e);const r=Object.keys(t);return i=>{b("Attempting to match query parameters");const a=fe.parse(ni(i));return b("  Expected query parameters:",t),b("  Actual query parameters:",a),r.every(c=>Array.isArray(a[c])?Array.isArray(t[c])?vn(a[c].sort(),t[c].sort()):!1:a[c]===t[c])}},"getQueryStringMatcher"),oi=o(({params:e,url:t})=>{if(b("Generating path parameters matcher"),!e){b("  No path parameters expectations defined - skipping");return}if(!/express:/.test(t))throw new Error("fetch-mock: matching on params is only possible when using an express: matcher");b("  Expected path parameters:",e);const r=Object.keys(e),i=[],a=_e(t.replace(/^express:/,""),i);return c=>{b("Attempting to match path parameters");const h=a.exec(bt(c))||[];h.shift();const d=i.reduce((l,{name:g},p)=>h[p]?Object.assign(l,{[g]:h[p]}):l,{});return b("  Expected path parameters:",e),b("  Actual path parameters:",d),r.every(l=>d[l]===e[l])}},"getParamsMatcher"),ai=o((e,t)=>{const r=t.getOption("matchPartialBody",e),{body:i}=e;return b("Generating body matcher"),(a,{body:c,method:h="get"})=>{if(b("Attempting to match body"),h.toLowerCase()==="get")return b("  GET request - skip matching body"),!0;let d;try{b("  Parsing request body as JSON"),d=JSON.parse(c)}catch(l){b("  Failed to parse request body as JSON",l)}return b("Expected body:",i),b("Actual body:",d),r&&b("matchPartialBody is true - checking for partial match only"),d&&(r?bn(d,i):vn(d,i))}},"getBodyMatcher"),Yt=o((e,t,r)=>{b("  Matching using full url",t);const i=Xt(t);return b("  Normalised url to:",t),e.identifier===t&&(b("  Updating route identifier to match normalized url:",t),e.identifier=i),a=>(b("Expected url:",i),b("Actual url:",a),r&&i.indexOf("?")?(b("Ignoring query string when matching url"),a.indexOf(i)===0):Xt(a)===i)},"getFullUrlMatcher"),ci=o(({functionMatcher:e})=>(b("Detected user defined function matcher",e),(...t)=>(b("Calling function matcher with arguments",t),e(...t))),"getFunctionMatcher"),ui=o(e=>{b("Generating url matcher");const{url:t,query:r}=e;if(t==="*")return b("  Using universal * rule to match any url"),()=>!0;if(t instanceof RegExp)return b("  Using regular expression to match url:",t),i=>t.test(i);if(t.href)return b("  Using URL object to match url",t),Yt(e,t.href,r);for(const i in Qt)if(t.indexOf(i+":")===0){b(`  Using ${i}: pattern to match url`,t);const a=t.replace(new RegExp(`^${i}:`),"");return Qt[i](a)}return Yt(e,t,r)},"getUrlMatcher");var li=[{name:"query",matcher:ii},{name:"method",matcher:si},{name:"headers",matcher:ri},{name:"params",matcher:oi},{name:"body",matcher:ai,usesBody:!0},{name:"functionMatcher",matcher:ci},{name:"url",matcher:ui}];const{debug:Zt,setDebugNamespace:en,getDebug:Ve}=pe,tn=o(e=>e instanceof RegExp||typeof e=="string"||typeof e=="object"&&"href"in e,"isUrlMatcher"),di=o(e=>typeof e=="function","isFunctionMatcher");class ee{constructor(t,r){this.fetchMock=r,Ve("compileRoute()")("Compiling route"),this.init(t),this.sanitize(),this.validate(),this.generateMatcher(),this.limit(),this.delayResponse()}validate(){if(!("response"in this))throw new Error("fetch-mock: Each route must define a response");if(!ee.registeredMatchers.some(({name:t})=>t in this))throw new Error("fetch-mock: Each route must specify some criteria for matching calls to fetch. To match all calls use '*'")}init(t){const[r,i,a={}]=t,c={};tn(r)||di(r)?c.matcher=r:Object.assign(c,r),typeof i<"u"&&(c.response=i),Object.assign(c,a),Object.assign(this,c)}sanitize(){const t=Ve("sanitize()");t("Sanitizing route properties"),this.method&&(t(`Converting method ${this.method} to lower case`),this.method=this.method.toLowerCase()),tn(this.matcher)&&(t("Mock uses a url matcher",this.matcher),this.url=this.matcher,delete this.matcher),this.functionMatcher=this.matcher||this.functionMatcher,t("Setting route.identifier..."),t(`  route.name is ${this.name}`),t(`  route.url is ${this.url}`),t(`  route.functionMatcher is ${this.functionMatcher}`),this.identifier=this.name||this.url||this.functionMatcher,t(`  -> route.identifier set to ${this.identifier}`)}generateMatcher(){en("generateMatcher()"),Zt("Compiling matcher for route");const t=ee.registeredMatchers.map(({name:r,matcher:i,usesBody:a})=>this[r]&&{matcher:i(this,this.fetchMock),usesBody:a}).filter(r=>Boolean(r));this.usesBody=t.some(({usesBody:r})=>r),Zt("Compiled matcher for route"),en(),this.matcher=(r,i={},a)=>t.every(({matcher:c})=>c(r,i,a))}limit(){const t=Ve("limit()");if(t("Limiting number of requests to handle by route"),!this.repeat){t("  No `repeat` value set on route. Will match any number of requests");return}t(`  Route set to repeat ${this.repeat} times`);const r=this.matcher;let i=this.repeat;this.matcher=(a,c)=>{if(i&&r(a,c))return i--,!0},this.reset=()=>i=this.repeat}delayResponse(){const t=Ve("delayResponse()");if(t("Applying response delay settings"),this.delay){t(`  Wrapping response in delay of ${this.delay} miliseconds`);const r=this.response;this.response=()=>(t(`Delaying response by ${this.delay} miliseconds`),new Promise(i=>setTimeout(()=>i(r),this.delay)))}else t("  No delay set on route. Will respond 'immediately' (but asynchronously)")}static addMatcher(t){ee.registeredMatchers.push(t)}}o(ee,"Route");ee.registeredMatchers=[];li.forEach(ee.addMatcher);var wt=ee;const{setDebugPhase:Xe,setDebugNamespace:Qe,debug:_}=pe,{normalizeUrl:wn}=Ze,G={},fi=o(e=>typeof e=="string"&&/^[\da-zA-Z\-]+$/.test(e),"isName"),hi=o(function(e,t={},r){return{matcher:e}=new wt([Object.assign({matcher:e,response:"ok"},t)],this),r.filter(({url:i,options:a})=>e(wn(i),a))},"filterCallsWithMatcher"),te=o(e=>function(...t){Xe("inspect");const r=e.call(this,...t);return Xe(),r},"formatDebug"),pi=o(e=>{if(!e)return;const{url:t,options:r,request:i,identifier:a,isUnmatched:c,response:h}=e,d=[t,r];return d.request=i,d.identifier=a,d.isUnmatched=c,d.response=h,d},"callObjToArray");G.filterCalls=function(e,t){_("Filtering fetch calls");let r=this._calls,i="*";return[!0,"matched"].includes(e)?(_(`Filter provided is ${e}. Returning matched calls only`),r=r.filter(({isUnmatched:a})=>!a)):[!1,"unmatched"].includes(e)?(_(`Filter provided is ${e}. Returning unmatched calls only`),r=r.filter(({isUnmatched:a})=>a)):typeof e>"u"?(_("Filter provided is undefined. Returning all calls"),r=r):fi(e)?(_("Filter provided, looks like the name of a named route. Returning only calls handled by that route"),r=r.filter(({identifier:a})=>a===e)):(i=e==="*"?"*":wn(e),this.routes.some(({identifier:a})=>a===i)&&(_(`Filter provided, ${e}, identifies a route. Returning only calls handled by that route`),r=r.filter(a=>a.identifier===i))),(t||i!=="*")&&r.length&&(typeof t=="string"&&(t={method:t}),_("Compiling filter and options to route in order to filter all calls",e),r=hi.call(this,i,t,r)),_(`Retrieved ${r.length} calls`),r.map(pi)};G.calls=te(function(e,t){return _("retrieving matching calls"),this.filterCalls(e,t)});G.lastCall=te(function(e,t){return _("retrieving last matching call"),[...this.filterCalls(e,t)].pop()});G.lastUrl=te(function(e,t){return _("retrieving url of last matching call"),(this.lastCall(e,t)||[])[0]});G.lastOptions=te(function(e,t){return _("retrieving options of last matching call"),(this.lastCall(e,t)||[])[1]});G.lastResponse=te(function(e,t){_("retrieving respose of last matching call"),console.warn(`When doing all the following:
- using node-fetch
- responding with a real network response (using spy() or fallbackToNetwork)
- using \`fetchMock.LastResponse()\`
- awaiting the body content
... the response will hang unless your source code also awaits the response body.
This is an unavoidable consequence of the nodejs implementation of streams.
`);const r=(this.lastCall(e,t)||[]).response;try{return r.clone()}catch{return Object.entries(r._fmResults).forEach(([a,c])=>{r[a]=()=>c}),r}});G.called=te(function(e,t){return _("checking if matching call was made"),Boolean(this.filterCalls(e,t).length)});G.flush=te(async function(e){Qe("flush"),_(`flushing all fetch calls. ${e?"":"Not "}waiting for response bodies to complete download`);const t=this._holdingPromises;this._holdingPromises=[],_(`${t.length} fetch calls to be awaited`),await Promise.all(t),_("All fetch calls have completed"),e&&this._holdingPromises.length&&(_("Awaiting all fetch bodies to download"),await this.flush(e),_("All fetch bodies have completed downloading")),Qe()});G.done=te(function(e){Xe("inspect"),Qe("done"),_("Checking to see if expected calls have been made");let t;e&&typeof e!="boolean"?(_("Checking to see if expected calls have been made for single route:",e),t=[{identifier:e}]):(_("Checking to see if expected calls have been made for all routes"),t=this.routes);const r=t.map(({identifier:i})=>{if(!this.called(i))return _("No calls made for route:",i),console.warn(`Warning: ${i} not called`),!1;const a=(this.routes.find(h=>h.identifier===i)||{}).repeat;if(!a)return _("Route has been called at least once, and no expectation of more set:",i),!0;const c=this.filterCalls(i).length;return _(`Route called ${c} times:`,i),a>c?(_(`Route called ${c} times, but expected ${a}:`,i),console.warn(`Warning: ${i} only called ${c} times, but ${a} expected`),!1):!0}).every(i=>i);return Qe(),Xe(),r});var gi=G;const{debug:_n}=pe,$=Object.assign({},Bs,Ms,gi);$.addMatcher=function(e){wt.addMatcher(e)};$.config={fallbackToNetwork:!1,includeContentLength:!0,sendAsJson:!0,warnOnFallback:!0,overwriteRoutes:void 0};$.createInstance=function(){_n("Creating fetch-mock instance");const e=Object.create($);return e._uncompiledRoutes=(this._uncompiledRoutes||[]).slice(),e.routes=e._uncompiledRoutes.map(t=>this.compileRoute(t)),e.fallbackResponse=this.fallbackResponse||void 0,e.config=Object.assign({},this.config||$.config),e._calls=[],e._holdingPromises=[],e.bindMethods(),e};$.compileRoute=function(e){return new wt(e,this)};$.bindMethods=function(){this.fetchHandler=$.fetchHandler.bind(this),this.reset=this.restore=$.reset.bind(this),this.resetHistory=$.resetHistory.bind(this),this.resetBehavior=$.resetBehavior.bind(this)};$.sandbox=function(){_n("Creating sandboxed fetch-mock instance");const t=Object.assign(o((r,i)=>t.fetchHandler(r,i),"fetchMockProxy"),$,this.createInstance(),{Headers:this.config.Headers,Request:this.config.Request,Response:this.config.Response});return t.bindMethods(),t.isSandbox=!0,t.default=t,t};$.getOption=function(e,t={}){return e in t?t[e]:this.config[e]};var Se=$;const yi={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var mi=yi;const me=typeof window<"u"?window:self,{setUrlImplementation:bi}=Ze;bi(me.URL);Se.global=me;Se.statusTextMap=mi;Se.config=Object.assign(Se.config,{Promise:me.Promise,Request:me.Request,Response:me.Response,Headers:me.Headers});var tt=Se.createInstance();const He={uuid:"1445bb87-4965-44a5-9889-1b82f49166ec",name:"Génération de document",description:'<a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank">Votre document est disponible ici</a>',state:"DONE",progression:100,created_at:"07/06/2021 12:22",started_at:"07/06/2021 14:22",completed_at:"07/06/2021 14:26"},ht={count:22,pending_count:2,previous:null,next:"mockAsyncTasks2",results:[{uuid:"31d69bd7-07e3-4567-a8f3-1aab41d86061",name:"Génération de document",description:"Votre document est en attente de génération",state:"PENDING",progression:0,created_at:"07/06/2021 12:22",started_at:null,completed_at:null},{uuid:"f66ecf3b-637c-413a-91a7-e318c27ce02f",name:"Génération de document",description:"Votre document est en cours de génération",state:"PROCESSING",progression:45,created_at:"07/06/2021 12:22",started_at:"07/06/2021 14:22",completed_at:null},{...He,uuid:"1445bb87-4965-44a5-9889-1b82f49166ec"},{...He,uuid:"1445bb87-4965-44a5-9889-1b82f49166ed"},{...He,uuid:"1445bb87-4965-44a5-9889-1b82f49166ee"},{...He,uuid:"1445bb87-4965-44a5-9889-1b82f49a66ef"}]},_i=o(()=>(tt.restore().get("*",{count:0,results:[]}),{components:{AsyncTasksViewer:Oe},template:`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" />
        </li>
      </ul>`}),"NoAsyncTasks"),Ci=o(()=>{const e={...ht};return tt.restore().get("/?limit=15",function(){return e.results=ht.results.slice(0,15),e}).get("/?limit=30",function(){return e.results=ht.results,e.next=null,e}),{components:{AsyncTasksViewer:Oe},template:`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" :interval="10" />
        </li>
      </ul>
    `}},"WithAsyncTasks"),Ai=o(()=>(tt.restore().get("*",{throws:new Error("Failed to fetch")}),{components:{AsyncTasksViewer:Oe},template:`
      <ul class="nav navbar-nav">
      <AsyncTasksViewer url="/" :interval="10" />
      </ul>
    `}),"WithErrors"),Ti=o(()=>(tt.restore().get("*",{count:0,results:[]}),{components:{AsyncTasksViewer:Oe},template:`
      <div class="clearfix">
        <ul class="nav navbar-nav clearfix">
          <li id="async-tasks-viewer" class="dropdown">
            <AsyncTasksViewer url="/" />
          </li>
        </ul>
      </div>
      <button onclick="let customEvent=new CustomEvent('AsyncTasksViewer:fetchAsyncTasks'); document.dispatchEvent(customEvent); ">
        Refresh via custom event
      </button>
    `}),"EventFetchAsyncTasks"),Ri={parameters:{storySource:{source:`/*
 *
 * OSIS stands for Open Student Information System. It's an application
 * designed to manage the core business of higher education institutions,
 * such as universities, faculties, institutes and professional schools.
 * The core business involves the administration of students, teachers,
 * courses, programs and so on.
 *
 * Copyright (C) 2015-2023 Université catholique de Louvain (http://www.uclouvain.be)
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * A copy of this license - GNU General Public License - is available
 * at the root of the source code of this program.  If not,
 * see http://www.gnu.org/licenses/.
 *
 */

import AsyncTasksViewer from './AsyncTasksViewer.vue';
import fetchMock from 'fetch-mock';
import type {EntriesResponse, Entry} from "./interfaces";
import type {Meta, StoryFn} from "@storybook/vue3";

const completedAsyncTask: Entry = {
  uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
  name: 'Génération de document',
  description: '<a href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" target="_blank">Votre document est disponible ici</a>',
  state: 'DONE',
  progression: 100,
  created_at: '07/06/2021 12:22',
  started_at: '07/06/2021 14:22',
  completed_at: '07/06/2021 14:26',
};

const mockAsyncTasks: EntriesResponse = {
  count: 22,
  pending_count: 2,
  previous: null,
  next: 'mockAsyncTasks2',
  results: [
    {
      uuid: '31d69bd7-07e3-4567-a8f3-1aab41d86061',
      name: 'Génération de document',
      description: 'Votre document est en attente de génération',
      state: 'PENDING',
      progression: 0,
      created_at: '07/06/2021 12:22',
      started_at: null,
      completed_at: null,
    }, {
      uuid: 'f66ecf3b-637c-413a-91a7-e318c27ce02f',
      name: 'Génération de document',
      description: 'Votre document est en cours de génération',
      state: 'PROCESSING',
      progression: 45,
      created_at: '07/06/2021 12:22',
      started_at: '07/06/2021 14:22',
      completed_at: null,
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ec',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ed',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49166ee',
    }, {
      ...completedAsyncTask,
      uuid: '1445bb87-4965-44a5-9889-1b82f49a66ef',
    },
  ],
};

export const NoAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {count: 0, results: []});
  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" />
        </li>
      </ul>\`,
  };
};

export const WithAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  const currentAsyncTaskPage = {...mockAsyncTasks};
  fetchMock.restore()
      .get('/?limit=15', function () {
        currentAsyncTaskPage.results = mockAsyncTasks.results.slice(0, 15);
        return currentAsyncTaskPage;
      })
      .get('/?limit=30', function () {
        currentAsyncTaskPage.results = mockAsyncTasks.results;
        currentAsyncTaskPage.next = null;
        return currentAsyncTaskPage;
      });

  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
        <li id="async-tasks-viewer" class="dropdown">
          <AsyncTasksViewer url="/" :interval="10" />
        </li>
      </ul>
    \`,
  };
};

export const WithErrors: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {throws: new Error('Failed to fetch')});

  return {
    components: {AsyncTasksViewer},
    template: \`
      <ul class="nav navbar-nav">
      <AsyncTasksViewer url="/" :interval="10" />
      </ul>
    \`,
  };
};


export const EventFetchAsyncTasks: StoryFn<typeof AsyncTasksViewer> = () => {
  fetchMock.restore().get('*', {count: 0, results: []});

  return {
    components: { AsyncTasksViewer },
    template: \`
      <div class="clearfix">
        <ul class="nav navbar-nav clearfix">
          <li id="async-tasks-viewer" class="dropdown">
            <AsyncTasksViewer url="/" />
          </li>
        </ul>
      </div>
      <button onclick="let customEvent=new CustomEvent('AsyncTasksViewer:fetchAsyncTasks'); document.dispatchEvent(customEvent); ">
        Refresh via custom event
      </button>
    \`,
  };
};

export default {
  title: 'Global component',
  component: AsyncTasksViewer,
} as Meta<typeof AsyncTasksViewer>;
`,locationsMap:{"no-async-tasks":{startLoc:{col:62,line:83},endLoc:{col:1,line:94},startBody:{col:62,line:83},endBody:{col:1,line:94}},"with-async-tasks":{startLoc:{col:64,line:96},endLoc:{col:1,line:119},startBody:{col:64,line:96},endBody:{col:1,line:119}},"with-errors":{startLoc:{col:60,line:121},endLoc:{col:1,line:132},startBody:{col:60,line:121},endBody:{col:1,line:132}},"event-fetch-async-tasks":{startLoc:{col:70,line:135},endLoc:{col:1,line:153},startBody:{col:70,line:135},endBody:{col:1,line:153}}}}},title:"Global component",component:Oe},ki=["NoAsyncTasks","WithAsyncTasks","WithErrors","EventFetchAsyncTasks"];export{Ti as EventFetchAsyncTasks,_i as NoAsyncTasks,Ci as WithAsyncTasks,Ai as WithErrors,ki as __namedExportsOrder,Ri as default};
//# sourceMappingURL=AsyncTasksViewer.stories-38cf64a4.js.map
